// Component: j-Exec
// Version: 1
// Updated: 2021-07-04 13:10
COMPONENT('exec',function(self,config){var regparent=/\?\d/;self.readonly();self.blind();self.make=function(){var scope=null,scopepath=function(el,val){if(!scope)scope=el.scope();return val==null?scope:scope?scope.makepath?scope.makepath(val):val.replace(/\?/g,el.scope().path):val};var fn=function(plus,forceprevent){return function(e){var el=$(this);var attr=el.attrd('exec'+plus);var path=el.attrd('path'+plus);var href=el.attrd('href'+plus);var def=el.attrd('def'+plus);var reset=el.attrd('reset'+plus);scope=null;var prevent=forceprevent?'1':el.attrd('prevent'+plus);if(prevent==='true'||prevent==='1'){e.preventDefault();e.stopPropagation()}if(attr){if(attr.charCodeAt(0)==='@'){attr=attr.substring(1);var com=el.component();if(com&&typeof(com[attr])==='function')com[attr](el,e);return}if(attr.indexOf('?')!==-1){var tmp=scopepath(el);if(tmp){var isparent=regparent.test(attr);attr=tmp.makepath?tmp.makepath(attr):attr.replace(/\?/g,tmp.path);if(isparent&&attr.indexOf('/')!==-1)M.scope(attr.split('/')[0]);else M.scope(tmp.path)}}EXEC(attr,el,e)}href&&NAV.redirect(href);if(def){if(def.indexOf('?')!==-1)def=scopepath(el,def);DEFAULT(def)}if(reset){if(reset.indexOf('?')!==-1)reset=scopepath(el,reset);RESET(reset)}if(path){var val=el.attrd('value');if(val){if(path.indexOf('?')!==-1)path=scopepath(el,path);var v=GET(path);SET(path,new Function('value','return '+val)(v),true)}}}};self.event('contextmenu',config.selector3||'.exec3',fn('3',true));self.event('dblclick',config.selector2||'.exec2',fn('2'));self.event('click',config.selector||'.exec',fn(''))}});
// End: j-Exec

// Component: j-ViewBox
// Version: 1
// Updated: 2021-06-03 21:39
COMPONENT('viewbox','margin:0;scroll:true;delay:100;initdelay:250;scrollbar:0;visibleY:1;height:100;invisible:1',function(self,config,cls){var eld,elb,scrollbar,cls2='.'+cls,init=false,cache,scrolltoforce;self.readonly();self.init=function(){var resize=function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='viewbox'&&com.dom.offsetParent&&com.$ready&&!com.$removed)com.resizeforce()}};ON('resize2',function(){setTimeout2('viewboxresize',resize,200)})};self.destroy=function(){scrollbar&&scrollbar.destroy()};self.configure=function(key,value,init){switch(key){case'disabled':eld.tclass('hidden',!value);break;case'minheight':case'margin':case'marginxs':case'marginsm':case'marginmd':case'marginlg':!init&&self.resizeforce();break;case'selector':config.parent=value;self.resize();break}};self.scrollbottom=function(val){if(val==null)return elb[0].scrollTop;elb[0].scrollTop=(elb[0].scrollHeight-self.dom.clientHeight)-(val||0);return elb[0].scrollTop};self.scrolltop=function(val){if(val==null)return elb[0].scrollTop;elb[0].scrollTop=(val||0);return elb[0].scrollTop};self.make=function(){config.invisible&&self.aclass('invisible');config.scroll&&MAIN.version>17&&self.element.wrapInner('<div class="'+cls+'-body"></div>');self.element.prepend('<div class="'+cls+'-disabled hidden"></div>');eld=self.find('> .{0}-disabled'.format(cls)).eq(0);elb=self.find('> .{0}-body'.format(cls)).eq(0);self.aclass('{0} {0}-hidden'.format(cls));if(config.scroll){if(config.scrollbar){if(MAIN.version>17){scrollbar=W.SCROLLBAR(self.find(cls2+'-body'),{shadow:config.scrollbarshadow,visibleY:config.visibleY,visibleX:config.visibleX,orientation:config.visibleX?null:'y',parent:self.element});self.scrolltop=scrollbar.scrollTop;self.scrollbottom=scrollbar.scrollBottom}else self.aclass(cls+'-scroll')}else{self.aclass(cls+'-scroll');self.find(cls2+'-body').aclass('noscrollbar')}}self.resize()};self.released=function(is){!is&&self.resize()};var css={};self.resize=function(){setTimeout2(self.ID,self.resizeforce,200)};self.resizeforce=function(){var el=self.parent(config.parent);var h=el.height();var w=el.width();var width=WIDTH();var mywidth=self.element.width();var key=width+'x'+mywidth+'x'+w+'x'+h+'x'+config.margin;if(cache===key){scrollbar&&scrollbar.resize();if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}return}cache=key;var margin=config.margin,responsivemargin=config['margin'+width];if(responsivemargin!=null)margin=responsivemargin;if(margin==='auto')margin=self.element.offset().top;if(h===0||w===0){self.$waiting&&clearTimeout(self.$waiting);self.$waiting=setTimeout(self.resize,234);return}h=((h/100)*config.height)-margin;if(config.minheight&&h<config.minheight)h=config.minheight;css.height=h;css.width=mywidth;eld.css(css);css.width='';self.css(css);elb.length&&elb.css(css);self.element.SETTER('*','resize');var c=cls+'-hidden';self.hclass(c)&&self.rclass(c,100);scrollbar&&scrollbar.resize();if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}if(!init){self.rclass('invisible',config.initdelay);init=true}};self.resizescrollbar=function(){scrollbar&&scrollbar.resize()};self.setter=function(){scrolltoforce=config.scrollto||config.scrolltop;if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}setTimeout(self.resize,config.delay,scrolltoforce)}});
// End: j-ViewBox

// Component: j-Input
// Version: 1
// Updated: 2021-10-06 21:05
COMPONENT('input','maxlength:200;dirkey:name;dirvalue:id;increment:1;autovalue:name;direxclude:false;checkicon:fa fa-check;forcevalidation:1;searchalign:1;height:80;after:\\:',function(self,config,cls){var cls2='.'+cls,input,placeholder,dirsource,binded,customvalidator,mask,rawvalue,isdirvisible=false,nobindcamouflage=false,focused=false;self.nocompile();self.bindvisible(20);self.init=function(){Thelpers.ui_input_icon=function(val){return val.charAt(0)==='!'||val.indexOf(' ')!==-1?('<span class="ui-input-icon-custom">'+(val.charAt(0)==='!'?val.substring(1):('<i class="'+val)+'"></i>')+'</span>'):('<i class="fa fa-'+val+'"></i>')};W.ui_input_template=Tangular.compile(('{{ if label}}<div class="{0}-label">{{ if icon}}<i class="{{ icon}}"></i>{{ fi}}{{ label | raw}}{{ after | raw}}</div>{{ fi}}<div class="{0}-control{{ if licon}} {0}-licon{{ fi}}{{ if ricon || (type === \'number\' && increment) }} {0}-ricon{{ fi}}">{{ if ricon || (type === \'number\' && increment) }}<div class="{0}-icon-right{{ if type === \'number\' && increment && !ricon}} {0}-increment{{ else if riconclick || type === \'date\' || type === \'time\' || (type === \'search\' && searchalign === 1) || type === \'password\' }} {0}-click{{ fi}}">{{ if type === \'number\' && !ricon}}<i class="fa fa-caret-up"></i><i class="fa fa-caret-down"></i>{{ else}}{{ ricon | ui_input_icon}}{{ fi}}</div>{{ fi}}{{ if licon}}<div class="{0}-icon-left{{ if liconclick || (type === \'search\' && searchalign !== 1) }} {0}-click{{ fi}}">{{ licon | ui_input_icon}}</div>{{ fi}}<div class="{0}-input{{ if align === 1 || align === \'center\' }} center{{ else if align === 2 || align === \'right\' }} right{{ fi}}">{{ if placeholder && !innerlabel}}<div class="{0}-placeholder">{{ placeholder}}</div>{{ fi}}{{ if dirsource || type === \'icon\' || type === \'emoji\' || type === \'color\' }}<div class="{0}-value" tabindex="0"></div>{{ else}}{{ if type === \'multiline\' }}<textarea data-jc-bind="" style="height:{{ height}}px"></textarea>{{ else}}<input type="{{ if type === \'password\' }}password{{ else}}text{{ fi}}"{{ if autofill}} autocomplete="on" name="{{ PATH}}"{{ else}} name="input'+Date.now()+'" autocomplete="new-password"{{ fi}} data-jc-bind=""{{ if maxlength > 0}} maxlength="{{ maxlength}}"{{ fi}}{{ if autofocus}} autofocus{{ fi}} />{{ fi}}{{ fi}}</div></div>{{ if error}}<div class="{0}-error hidden"><i class="fa fa-warning"></i> {{ error}}</div>{{ fi}}').format(cls))};self.make=function(){if(!config.label)config.label=self.html();if(isMOBILE&&config.autofocus)config.autofocus=false;config.PATH=self.path.replace(/\./g,'_');self.aclass(cls+' invisible');self.rclass('invisible',100);self.redraw();self.event('input change',function(){if(nobindcamouflage)nobindcamouflage=false;else self.check()});self.event('click',cls2+'-checkbox',function(){if(config.disabled){$(this).blur();return}self.change(true);var val=self.get();if(val===1)val=0;else if(val===0)val=1;else if(val===true)val=false;else val=true;self.set(val,2)});self.event('focus','input,'+cls2+'-value',function(){if(config.disabled){$(this).blur();return}focused=true;self.camouflage(false);self.aclass(cls+'-focused');config.autocomplete&&EXEC(self.makepath(config.autocomplete),self,input.parent());if(config.autosource){var opt={};opt.element=self.element;opt.search=GET(self.makepath(config.autosource));opt.callback=function(value){var val=typeof(value)==='string'?value:value[config.autovalue];if(config.autoexec){EXEC(self.makepath(config.autoexec),value,function(val){self.set(val,2);self.change();self.bindvalue()})}else{self.set(val,2);self.change();self.bindvalue()}};SETTER('autocomplete','show',opt)}else if(config.mask){setTimeout(function(input){input.selectionStart=input.selectionEnd=0},50,this)}else if(config.dirsource&&(config.autofocus!=false&&config.autofocus!=0)){if(!isdirvisible)self.find(cls2+'-control').trigger('click')}else if(config.type==='date'||config.type==='time'){setTimeout(function(){self.element.find(cls2+'-icon-right').trigger('click')},300)}});self.event('paste','input',function(e){if(config.mask){var val=(e.originalEvent.clipboardData||window.clipboardData).getData('text');self.set(val.replace(/\s|\t/g,''));e.preventDefault()}self.check()});self.event('keydown','input',function(e){var t=this,code=e.which;if(t.readOnly||config.disabled){if(e.keyCode!==9){if(config.dirsource){self.find(cls2+'-control').trigger('click');return}e.preventDefault();e.stopPropagation()}return}if(!config.disabled&&config.dirsource&&(code===13||code>30)){self.find(cls2+'-control').trigger('click');return}if(config.mask){if(e.metaKey){if(code===8||code===127){e.preventDefault();e.stopPropagation()}return}if(code===32){e.preventDefault();e.stopPropagation();return}var beg=e.target.selectionStart,end=e.target.selectionEnd,val=t.value,c;if(code===8||code===127){if(beg===end){c=config.mask.substring(beg-1,beg);t.value=val.substring(0,beg-1)+c+val.substring(beg);self.curpos(beg-1)}else{for(var i=beg;i<=end;i++){c=config.mask.substring(i-1,i);val=val.substring(0,i-1)+c+val.substring(i)}t.value=val;self.curpos(beg)}e.preventDefault();return}if(code>40){var cur=String.fromCharCode(code);if(mask&&mask[beg]){if(!mask[beg].test(cur)){e.preventDefault();return}}c=config.mask.charCodeAt(beg);if(c!==95){beg++;while(true){c=config.mask.charCodeAt(beg);if(c===95||isNaN(c))break;else beg++}}if(c===95){val=val.substring(0,beg)+cur+val.substring(beg+1);t.value=val;beg++;while(beg<config.mask.length){c=config.mask.charCodeAt(beg);if(c===95)break;else beg++}self.curpos(beg)}else self.curpos(beg+1);e.preventDefault();e.stopPropagation()}}});self.event('blur','input,'+cls2+'-value',function(){focused=false;self.camouflage(true);self.rclass(cls+'-focused')});self.event('click',cls2+'-control',function(){if(config.disabled||isdirvisible)return;if(config.type==='icon'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(val){self.change(true);self.set(val,2);self.check();rawvalue[0].focus()};SETTER('faicons','show',opt);return}else if(config.type==='color'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(al){self.change(true);self.set(al,2);self.check();rawvalue[0].focus()};SETTER('colorpicker','show',opt);return}else if(config.type==='emoji'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(al){self.change(true);self.set(al,2);self.check();rawvalue[0].focus()};SETTER('emoji','show',opt);return}if(!config.dirsource)return;isdirvisible=true;setTimeout(function(){isdirvisible=false},500);var opt={};opt.element=self.find(cls2+'-control');opt.items=dirsource||GET(self.makepath(config.dirsource));opt.offsetY=-1+(config.diroffsety||0);opt.offsetX=0+(config.diroffsetx||0);opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(self.makepath(config.dirrender)):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;opt.checkbox=!!config.multiple;var val=self.get();if(config.multiple){for(var i=0;i<opt.items.length;i++){var item=opt.items[i];if(val instanceof Array){item.selectedts=val.indexOf(item[config.dirvalue||config.value]);item.selected=item.selectedts!==-1}else item.selected=false}}else opt.selected=val;if(config.dirraw)opt.raw=true;if(config.dirsearch!=null)opt.search=config.dirsearch;if(dirsource&&config.direxclude==false&&!config.multiple){for(var i=0;i<dirsource.length;i++){var item=dirsource[i];if(item)item.selected=typeof(item)==='object'&&item[config.dirvalue]===val}}else if(config.direxclude){opt.exclude=function(item){return item?item[config.dirvalue]===val:false}}opt.callback=function(item,el,custom){if(item==null||(config.multiple&&!item.length)){rawvalue.html('');self.set(config.multiple?[]:null,2);self.change();self.check();return}if(config.multiple){var arr=[];for(var i=0;i<item.length;i++){var m=item[i];arr.push(m[config.dirvalue||config.value])}self.set(arr,2);self.change(true);return}var val=custom||typeof(item)==='string'?item:item[config.dirvalue||config.value];if(custom&&typeof(config.dircustom)==='string'){var fn=GET(config.dircustom);fn(val,function(val){self.set(val,2);self.change(true);self.bindvalue()})}else if(custom){if(val){self.set(val,2);self.change(true);if(dirsource)self.bindvalue();else input.val(val)}}else{self.set(val,2);self.change(true);if(dirsource)self.bindvalue();else input.val(val)}rawvalue[0].focus()};SETTER('directory','show',opt)});self.event('click',cls2+'-placeholder,'+cls2+'-label',function(e){if(!config.disabled){if(config.dirsource){e.preventDefault();e.stopPropagation();self.find(cls2+'-control').trigger('click')}else if(!config.camouflage||$(e.target).hclass(cls+'-placeholder')){if(input.length){input[0].focus()}else rawvalue[0].focus()}}});self.event('click',cls2+'-icon-left,'+cls2+'-icon-right',function(e){if(config.disabled)return;var el=$(this);var left=el.hclass(cls+'-icon-left');var opt;if(config.dirsource&&left&&config.liconclick){e.preventDefault();e.stopPropagation()}if(!left&&!config.riconclick){if(config.type==='date'){opt={};opt.element=self.element;opt.value=self.get();opt.callback=function(val){self.change(true);self.set(val)};SETTER('datepicker','show',opt)}else if(config.type==='time'){opt={};opt.element=self.element;opt.value=self.get();opt.callback=function(val){self.change(true);self.set(val)};SETTER('timepicker','show',opt)}else if(config.type==='search')self.set('');else if(config.type==='password')self.password();else if(config.type==='number'){var tmp=$(e.target);if(tmp.attr('class').indexOf('fa-')!==-1){var n=tmp.hclass('fa-caret-up')?1:-1;self.change(true);var val=self.preparevalue((self.get()||0)+(config.increment*n));self.set(val,2)}}return}if(left&&config.liconclick)EXEC(self.makepath(config.liconclick),self,el);else if(config.riconclick)EXEC(self.makepath(config.riconclick),self,el);else if(left&&config.type==='search')self.set('')})};self.camouflage=function(is){if(config.camouflage){if(is){var t=input[0],arr=t.value.split('');for(var i=0;i<arr.length;i++)arr[i]=typeof(config.camouflage)==='string'?config.camouflage:'•';nobindcamouflage=true;t.value=arr.join('')}else{nobindcamouflage=true;var val=self.get();input[0].value=val==null?'':val}self.tclass(cls+'-camouflaged',is)}};self.curpos=function(pos){var el=input[0];if(el.createTextRange){var range=el.createTextRange();range.move('character',pos);range.select()}else if(el.selectionStart){el.focus();el.setSelectionRange(pos,pos)}};self.validate=function(value){if((!config.required||config.disabled)&&!self.forcedvalidation())return true;if(config.disabled)return true;if(config.dirsource)return!!value;if(customvalidator)return customvalidator(value);if(config.type==='date')return value instanceof Date&&!isNaN(value.getTime());if(config.type==='checkbox')return value===true||value===1;if(value==null)value='';else value=value.toString();if(config.mask&&typeof(value)==='string'&&value.indexOf('_')!==-1)return false;if(config.minlength&&value.length<config.minlength)return false;switch(config.type){case'email':return value.isEmail();case'phone':return value.isPhone();case'url':return value.isURL();case'zip':return(/^\d{5}(?:[-\s]\d{4})?$/).test(value);case'currency':case'number':value=value.parseFloat();if((config.minvalue!=null&&value<config.minvalue)||(config.maxvalue!=null&&value>config.maxvalue))return false;return config.minvalue==null?value>0:true}return value.length>0};self.offset=function(){var offset=self.element.offset();var control=self.find(cls2+'-control');var width=control.width()+2;return{left:offset.left,top:control.offset().top+control.height(),width:width}};self.password=function(show){var visible=show==null?input.attr('type')==='text':show;input.attr('type',visible?'password':'text');self.find(cls2+'-icon-right').find('i').tclass(config.ricon,visible).tclass('fa-eye-slash',!visible)};self.preparevalue=function(value){if(config.type==='number'&&(config.minvalue!=null||config.maxvalue!=null)){var tmp=typeof(value)==='string'?+value.replace(',','.'):value;if(config.minvalue>tmp)value=config.minvalue;if(config.maxvalue<tmp)value=config.maxvalue}return value};self.getterin=self.getter;self.getter=function(value,realtime,nobind){if(nobindcamouflage)return;if(config.mask&&config.masktidy){var val=[];for(var i=0;i<value.length;i++){if(config.mask.charAt(i)==='_')val.push(value.charAt(i))}value=val.join('')}self.getterin(self.preparevalue(value),realtime,nobind)};self.setterin=self.setter;self.setter=function(value,path,type){if(config.mask){if(value){if(config.masktidy){var index=0,val=[];for(var i=0;i<config.mask.length;i++){var c=config.mask.charAt(i);val.push(c==='_'?(value.charAt(index++)||'_'):c)}value=val.join('')}if(mask){var arr=[];for(var i=0;i<mask.length;i++){var c=value.charAt(i);if(mask[i]&&mask[i].test(c))arr.push(c);else arr.push(config.mask.charAt(i))}value=arr.join('')}}else value=config.mask}self.setterin(value,path,type);self.bindvalue();config.camouflage&&!focused&&setTimeout(self.camouflage,type==='show'?2000:1,true);if(config.type==='password')self.password(true)};self.check=function(){var is=false;if(config.dirsource)is=!!rawvalue.text();else is=input&&input.length?!!input[0].value:!!self.get();if(binded===is)return;binded=is;placeholder&&placeholder.tclass('hidden',is);self.tclass(cls+'-binded',is);if(config.type==='search')self.find(cls2+'-icon-'+(config.searchalign===1?'right':'left')).find('i').tclass(config.searchalign===1?config.ricon:config.licon,!is).tclass('fa-times',is)};self.bindvalue=function(){var value=self.get();if(dirsource){var item,text=[];for(var i=0;i<dirsource.length;i++){item=dirsource[i];if(typeof(item)==='string'){if(item===value)break;item=null}else if(config.multiple){var v=item[config.dirvalue||config.value],index=value instanceof Array?value.indexOf(v):-1;if(index!==-1)text.push({index:index,value:item[config.dirkey||config.key]})}else if(item[config.dirvalue||config.value]===value){item=item[config.dirkey||config.key];break}else item=null}if(config.multiple){text.quicksort('index');for(var i=0;i<text.length;i++)text[i]=text[i].value;item=text.join(', ')}else if(value&&item==null&&config.dircustom)item=value;if(config.dirraw)rawvalue.html(item||'');else rawvalue.text(item||'')}else if(config.dirsource){if(config.dirdetail){self.EXEC(config.dirdetail,value,function(val){if(config.dirraw)rawvalue.html(val||'');else rawvalue.text(val||'');self.check()});return}else if(config.dirraw)rawvalue.html(value||'');else rawvalue.text(value||'')}else{switch(config.type){case'color':rawvalue.css('background-color',value||'');break;case'icon':rawvalue.html('<i class="{0}"></i>'.format(value||''));break;case'emoji':rawvalue.html(value);break;case'checkbox':self.tclass(cls+'-checked',value===true||value===1);break}}self.check()};self.redraw=function(){if(!config.ricon){if(config.dirsource)config.ricon='angle-down';else if(config.type==='date'){config.ricon='calendar';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='icon'||config.type==='color'||config.type==='emoji'){config.ricon='angle-down';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='time'){config.ricon='clock-o';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='search')if(config.searchalign===1)config.ricon='search';else config.licon='search';else if(config.type==='password')config.ricon='eye';else if(config.type==='number'){if(!config.align&&!config.innerlabel)config.align=1}}self.tclass(cls+'-masked',!!config.mask);self.rclass2(cls+'-type-');if(config.type)self.aclass(cls+'-type-'+config.type);var html,is=false;if(config.type==='checkbox'){html='<div class="{0}-checkbox"><span><i class="{checkicon}"></i></span><label>{label}</label></div>'.format(cls).arg(config)}else{is=true;html=W.ui_input_template(config)}self.html(html);if(is){input=self.find('input,textarea');rawvalue=self.find(cls2+'-value');placeholder=self.find(cls2+'-placeholder')}else input=rawvalue=placeholder=null};self.configure=function(key,value){switch(key){case'icon':if(value&&value.indexOf(' ')===-1)config.icon='fa fa-'+value;break;case'dirsource':if(config.dirajax||value.indexOf('/')!==-1){dirsource=null;self.bindvalue()}else{if(value.indexOf(',')!==-1){dirsource=self.parsesource(value);self.bindvalue()}else{self.datasource(value,function(path,value){dirsource=value;self.bindvalue()})}}self.tclass(cls+'-dropdown',!!value);input.prop('readonly',!!config.disabled||!!config.dirsource);break;case'disabled':self.tclass('ui-disabled',!!value);input&&input.prop('readonly',!!value||!!config.dirsource);self.reset();break;case'required':self.tclass(cls+'-required',!!value);self.reset();break;case'type':self.type=value;break;case'validate':customvalidator=value?(/\(|=|>|<|\+|-|\)/).test(value)?FN('value=>'+value):(function(path){path=self.makepath(path);return function(value){return GET(path)(value)}})(value):null;break;case'innerlabel':self.tclass(cls+'-inner',!!value);break;case'monospace':self.tclass(cls+'-monospace',!!value);break;case'maskregexp':if(value){mask=value.toLowerCase().split(',');for(var i=0;i<mask.length;i++){var m=mask[i];if(!m||m==='null')mask[i]='';else mask[i]=new RegExp(m)}}else mask=null;break;case'mask':config.mask=value.replace(/#/g,'_');break}};self.formatter(function(path,value){if(value){switch(config.type){case'lower':return(value+'').toLowerCase();case'upper':return(value+'').toUpperCase();case'phone':return(value+'').replace(/\s/g,'');case'email':return(value+'').toLowerCase();case'date':return value.format(config.format||DEF.dateformat||'yyyy-MM-dd');case'time':return value.format(config.format||'HH:mm');case'number':return config.format?value.format(config.format):value}}return value});self.parser(function(path,value){if(value){var tmp;switch(config.type){case'date':tmp=self.get();if(tmp)tmp=tmp.format('HH:mm');else tmp='';return value+(tmp?(' '+tmp):'');case'lower':case'email':value=value.toLowerCase();break;case'upper':value=value.toUpperCase();break;case'phone':value=value.replace(/\s/g,'');break;case'time':tmp=value.split(':');var dt=self.get();value=dt?new Date(dt.getTime()):new Date();value.setHours((tmp[0]||'0').parseInt());value.setMinutes((tmp[1]||'0').parseInt());value.setSeconds((tmp[2]||'0').parseInt());break}}return value?config.spaces===false?value.replace(/\s/g,''):value:value});self.state=function(type,what){if(type){if(type===1&&what===4){self.rclass(cls+'-ok '+cls+'-invalid');self.$oldstate=null;return}var invalid=config.required?self.isInvalid():self.forcedvalidation()?self.isInvalid():false;if(invalid!==self.$oldstate){self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid);self.tclass(cls+'-ok',!invalid);config.error&&self.find(cls2+'-error').tclass('hidden',!invalid)}}};self.forcedvalidation=function(){if(!config.forcevalidation)return false;if(config.type==='number')return false;var val=self.get();if(config.type==='checkbox')return val===true||val===1;return(config.type==='phone'||config.type==='email')&&(val!=null&&(typeof(val)==='string'&&val.length!==0))}});
// End: j-Input

// Component: j-Enter
// Version: 1
// Updated: 2021-09-28 16:50
COMPONENT('enter','validate:1;trigger:button[name="submit"];flags:visible;timeout:1500;delay:500',function(self,config){var flags,delay=null,submit=function(btn){delay=null;if(btn)btn.trigger('click');else self.EXEC(config.exec,self)};self.readonly();self.make=function(){self.event('keydown','input',function(e){if(e.which===13&&(!config.validate||!self.path||CAN(self.path,flags))){if(config.exec){if(!BLOCKED(self.ID,config.timeout)){delay&&clearTimeout(delay);delay=setTimeout(submit,config.delay)}}else{var btn=self.find(config.trigger);if(!btn.prop('disabled')){if(!BLOCKED(self.ID,config.timeout)){delay&&clearTimeout(delay);delay=setTimeout(submit,config.delay,btn)}}}}})};self.configure=function(key,value){switch(key){case'flags':if(value){flags=value.split(',');for(var i=0;i<flags.length;i++)flags[i]='@'+flags[i]}else flags=null;break}}});
// End: j-Enter

// Component: j-Validation
// Version: 1
// Updated: 2021-03-16 21:25
COMPONENT('validation','delay:100;flags:visible',function(self,config,cls){var elements=null,def='button[name="submit"]',flags=null,tracked=false,reset=0,old,track;self.readonly();self.make=function(){elements=self.find(config.selector||def)};self.configure=function(key,value,init){switch(key){case'selector':if(!init)elements=self.find(value||def);break;case'flags':if(value){flags=value.split(',');for(var i=0;i<flags.length;i++)flags[i]='@'+flags[i]}else flags=null;break;case'track':track=value.split(',').trim();break}};var settracked=function(){tracked=0};self.setter=function(value,path,type){var is=path===self.path||path.length<self.path.length;if(reset!==is){reset=is;self.tclass(cls+'-modified',!reset)}if((type===1||type===2)&&track&&track.length){for(var i=0;i<track.length;i++){if(path.indexOf(track[i])!==-1){tracked=1;return}}if(tracked===1){tracked=2;setTimeout(settracked,config.delay*3)}}};var check=function(){var path=self.path.replace(/\.\*$/,'');var disabled=tracked||config.validonly?!VALID(path,flags):DISABLED(path,flags);if(!disabled&&config.if)disabled=!EVALUATE(path,config.if);if(disabled!==old){elements.prop('disabled',disabled);self.tclass(cls+'-ok',!disabled);self.tclass(cls+'-no',disabled);old=disabled}};self.state=function(type,what){if(type===3||what===3){self.rclass(cls+'-modified');tracked=0}setTimeout2(self.ID,check,config.delay)}});
// End: j-Validation

// Component: j-Menu
// Version: 1
// Updated: 2020-12-03 11:08
COMPONENT('menu',function(self,config,cls){self.singleton();self.readonly();self.nocompile&&self.nocompile();var cls2='.'+cls,is=false,issubmenu=false,isopen=false,events={},ul,children,prevsub,parentclass;self.make=function(){self.aclass(cls+' hidden '+cls+'-style-'+(config.style||1));self.append('<div class="{0}-items"><ul></ul></div><div class="{0}-submenu hidden"><ul></ul></div>'.format(cls));ul=self.find(cls2+'-items').find('ul');children=self.find(cls2+'-submenu');self.event('click','li',function(e){clearTimeout2(self.ID);var el=$(this);if(!el.hclass(cls+'-divider')&&!el.hclass(cls+'-disabled')){self.opt.scope&&M.scope(self.opt.scope);var index=el.attrd('index').split('-');if(index.length>1){self.opt.callback(self.opt.items[+index[0]].children[+index[1]]);self.hide()}else if(!issubmenu){self.opt.callback(self.opt.items[+index[0]]);self.hide()}}e.preventDefault();e.stopPropagation()});events.hide=function(){is&&self.hide()};self.event('scroll',events.hide);self.on('reflow + scroll + resize + resize2',events.hide);events.click=function(e){if(is&&!isopen&&(!self.target||(self.target!==e.target&&!self.target.contains(e.target))))setTimeout2(self.ID,self.hide,isMOBILE?700:300)};events.hidechildren=function(){if($(this.parentNode.parentNode).hclass(cls+'-items')){if(prevsub&&prevsub[0]!==this){prevsub.rclass(cls+'-selected');prevsub=null;children.aclass('hidden');issubmenu=false}}};events.children=function(){if(prevsub&&prevsub[0]!==this){prevsub.rclass(cls+'-selected');prevsub=null}issubmenu=true;isopen=true;setTimeout(function(){isopen=false},500);var el=prevsub=$(this);var index=+el.attrd('index');var item=self.opt.items[index];el.aclass(cls+'-selected');var html=self.makehtml(item.children,index);children.find('ul').html(html);children.rclass('hidden');var css={},offset=el.position();css.left=ul.width()-5;css.top=offset.top-5;var offsetX=offset.left;offset=self.element.offset();var w=children.width();var left=offset.left+css.left+w;if(left>WW+30)css.left=(offsetX-w)+5;children.css(css)}};self.bindevents=function(){events.is=true;$(document).on('touchstart mouseenter mousedown',cls2+'-children',events.children).on('touchstart mousedown',events.click);$(W).on('scroll',events.hide);self.element.on('mouseenter','li',events.hidechildren)};self.unbindevents=function(){events.is=false;$(document).off('touchstart mouseenter mousedown',cls2+'-children',events.children).off('touchstart mousedown',events.click);$(W).off('scroll',events.hide);self.element.off('mouseenter','li',events.hidechildren)};self.showxy=function(x,y,items,callback){var opt={};opt.x=x;opt.y=y;opt.items=items;opt.callback=callback;self.show(opt)};self.makehtml=function(items,index){var builder=[],tmp;for(var i=0;i<items.length;i++){var item=items[i];if(typeof(item)==='string'){if(item==='-')tmp='<hr />';else tmp='<span>{0}</span>'.format(item);builder.push('<li class="{0}-divider">{1}</li>'.format(cls,tmp));continue}var cn=item.classname||'',icon='';if(item.icon)icon='<i class="{0}"></i>'.format(item.icon.charAt(0)==='!'?item.icon.substring(1):item.icon.indexOf('fa-')===-1?('fa fa-'+item.icon):item.icon);else cn=(cn?(cn+' '):'')+cls+'-nofa';tmp='';if(index==null&&item.children&&item.children.length){cn+=(cn?' ':'')+cls+'-children';tmp+='<i class="fa fa-play pull-right"></i>'}if(item.selected)cn+=(cn?' ':'')+cls+'-selected';if(item.disabled)cn+=(cn?' ':'')+cls+'-disabled';tmp+='<div class="{0}-name">{1}{2}{3}</div>'.format(cls,icon,item.name,item.shortcut?'<b>{0}</b>'.format(item.shortcut):'');if(item.note)tmp+='<div class="ui-menu-note">{0}</div>'.format(item.note);builder.push('<li class="{0}" data-index="{2}">{1}</li>'.format(cn,tmp,(index!=null?(index+'-'):'')+i))}return builder.join('')};self.show=function(opt){if(typeof(opt)==='string'){opt={align:opt};opt.element=arguments[1];opt.items=arguments[2];opt.callback=arguments[3];opt.offsetX=arguments[4];opt.offsetY=arguments[5]}var tmp=opt.element?opt.element instanceof jQuery?opt.element[0]:opt.element.element?opt.element.dom:opt.element:null;if(is&&tmp&&self.target===tmp){self.hide();return}var tmp;self.target=tmp;self.opt=opt;opt.scope=M.scope();if(parentclass&&opt.classname!==parentclass){self.rclass(parentclass);parentclass=null}if(opt.large)self.aclass('ui-large');else self.rclass('ui-large');isopen=false;issubmenu=false;prevsub=null;var css={};children.aclass('hidden');children.find('ul').empty();clearTimeout2(self.ID);ul.html(self.makehtml(opt.items));if(!parentclass&&opt.classname){self.aclass(opt.classname);parentclass=opt.classname}if(is){css.left=0;css.top=0;self.element.css(css)}else{self.rclass('hidden');self.aclass(cls+'-visible',100);is=true;if(!events.is)self.bindevents()}var target=$(opt.element);var w=self.width();var offset=target.offset();if(opt.element){switch(opt.align){case'center':css.left=Math.ceil((offset.left-w/2)+(target.innerWidth()/2));break;case'right':css.left=(offset.left-w)+target.innerWidth();break;default:css.left=offset.left;break}css.top=opt.position==='bottom'?(offset.top-self.element.height()-10):(offset.top+target.innerHeight()+10)}else{css.left=opt.x;css.top=opt.y}if(opt.position==='bottom')css.top+=10;else css.top-=10;if(opt.offsetX)css.left+=opt.offsetX;if(opt.offsetY)css.top+=opt.offsetY;var mw=w,mh=self.height();if(css.left<0)css.left=10;else if((mw+css.left)>WW)css.left=(WW-mw)-10;if(css.top<0)css.top=10;else if((mh+css.top)>WH)css.top=(WH-mh)-10;self.element.css(css)};self.hide=function(){events.is&&self.unbindevents();is=false;self.opt&&self.opt.hide&&self.opt.hide();self.target=null;self.opt=null;self.aclass('hidden');self.rclass(cls+'-visible')}});
// End: j-Menu

// Component: j-Clipboard
// Version: 1
// Updated: 2019-01-07 23:56
COMPONENT('clipboard',function(self){var container;self.singleton();self.readonly();self.nocompile&&self.nocompile();self.copy=function(value){container.val(value);container.focus();container.select();document.execCommand('copy');container.blur()};self.make=function(){var id='clipboard'+self.id;$(document.body).append('<textarea id="{0}" class="ui-clipboard"></textarea>'.format(id));container=$('#'+id)};self.setter=function(value){value&&self.copy(value)}});
// End: j-Clipboard

// Component: j-Ready
// Version: 1
// Updated: 2020-12-29 12:35
COMPONENT('ready','delay:800',function(self,config){self.readonly();self.blind();self.make=function(){config.rclass&&self.rclass(config.rclass,config.adelay||config.delay);config.aclass&&self.aclass(config.aclass,config.rdelay||config.delay);config.focus&&setTimeout(function(){self.find(config.focus===true||config.focus===1?'input[type="text"],textarea,select':config.focus).focus()},config.fdelay||(config.delay+5))}});
// End: j-Ready

// Component: j-Importer
// Version: 1
// Updated: 2021-03-29 11:15
COMPONENT('importer',function(self,config){var init=false,clid=null,pending=false,content='',replace=function(value){return self.scope?self.makepath(value):value.replace(/\?/g,config.path||config.if)};var replace2=function(value){return value?value.replace(/~PATH~/g,config.path||config.if):value};self.readonly();self.make=function(){var scr=self.find('script');content=scr.length?scr.html():''};self.reload=function(recompile){config.reload&&EXEC(replace(config.reload));recompile&&COMPILE();setTimeout(function(){pending=false;init=true},1000)};self.setter=function(value){if(pending)return;if(config.if!==value){if(config.cleaner&&init&&!clid)clid=setTimeout(self.clean,config.cleaner*60000);return}pending=true;if(clid){clearTimeout(clid);clid=null}if(init){self.reload();return}if(content){self.html(replace2(content));setTimeout(self.reload,50,true)}else self.import(config.url,self.reload,true,replace2)};self.clean=function(){config.clean&&EXEC(replace(config.clean));setTimeout(function(){self.empty();init=false;clid=null},1000)}});
// End: j-Importer

// Component: j-InputTags
// Version: 1
// Updated: 2021-10-03 15:14
COMPONENT('inputtags','dirkey:name;dirvalue:id;transform:0;enteronly:1;after:\\:',function(self,config){var cls='ui-inputtags',cls2='.'+cls,input,placeholder,dirsource,binded,customvalidator,tags,skip=false;self.nocompile();self.bindvisible(50);self.init=function(){Thelpers.ui_inputtags_icon=function(val){return val.charAt(0)==='!'?('<span class="ui-inputtags-icon-custom">'+val.substring(1)+'</span>'):('<i class="fa fa-'+val+'"></i>')};W.ui_inputtags_template=Tangular.compile(('{{ if label}}<div class="{0}-label">{{ if icon}}<i class="fa fa-{{ icon}}"></i>{{ fi}}{{ label}}{{ after}}</div>{{ fi}}<div class="{0}-control{{ if dirsource}} {0}-dropdown{{ fi}}{{ if licon}} {0}-licon{{ fi}}{{ if ricon}} {0}-ricon{{ fi}}">{{ if ricon}}<div class="{0}-icon-right">{{ ricon | ui_inputtags_icon}}</div>{{ fi}}{{ if licon}}<div class="{0}-icon-left{{ if liconclick}} {0}-click{{ fi}}">{{ licon | ui_inputtags_icon}}</div>{{ fi}}<div class="{0}-input{{ if align === 1 || align === \'center\' }} center{{ else if align === 2 || align === \'right\' }} right{{ fi}}">{{ if placeholder && !innerlabel}}<div class="{0}-placeholder">{{ placeholder}}</div>{{ fi}}<div class="{0}-tags"><span class="{0}-editable" contenteditable="true"></span></div></div></div>{{ if error}}<div class="{0}-error hidden"><i class="fa fa-warning"></i> {{ error}}</div>{{ fi}}').format(cls))};self.make=function(){if(!config.label)config.label=self.html();if(isMOBILE&&config.autofocus)config.autofocus=false;config.PATH=self.path.replace(/\./g,'_');self.aclass(cls+' invisible');self.rclass('invisible',100);self.redraw();self.event('input change focusout',function(e){self.check();if(!config.enteronly&&e.type==='focusout'){setTimeout(function(){var val=input.text();val&&self.appendval(val);input.html('')},100)}});self.event('focus',cls2+'-editable',function(){self.aclass(cls+'-focused');config.autocomplete&&EXEC(config.autocomplete,self,input.parent());if(config.autosource){var opt={};opt.element=self.element;opt.search=GET(self.makepath(config.autosource));opt.callback=function(value){input.empty();self.appendval(typeof(value)==='string'?value:value[config.autovalue]);self.check()};SETTER('autocomplete','show',opt)}});self.event('blur',cls2+'-editable',function(){self.rclass(cls+'-focused')});self.event('click','.fa-times',function(e){var index=$(this).parent().index();self.removetag(index);e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-tag',function(e){e.stopPropagation();e.preventDefault()});self.findvalue=function(arr,val){for(var i=0;i<arr.length;i++){if(arr[i]&&(arr[i]===val||arr[i][config.value]===val))return arr[i]}};self.event('click',cls2+'-control',function(){if(!config.dirsource||config.disabled)return;var opt={};opt.element=self.find(cls2+'-control');opt.items=dirsource;opt.offsetY=-1;opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(self.makepath(config.dirrender)):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;if(config.dirvalue&&typeof(dirsource)!=='function'){var val=self.get()||EMPTYARRAY;opt.exclude=function(item){return item?typeof(item)==='string'?self.findvalue(val,item):self.findvalue(val,item[config.dirvalue]):false}}opt.callback=function(item,el,custom){if(item==null||(custom&&!opt.custom))return;var val=custom||(typeof(item)==='string'?item:item[config.dirvalue||config.value]);if(custom){if(typeof(config.dircustom)==='string'){var fn=GET(self.makepath(config.dircustom));fn(val,function(val){self.appendval(val,true)})}else self.appendval(item,true)}else if(!custom)self.appendval(typeof(dirsource)==='function'?item:val)};SETTER('directory','show',opt)});self.event('click',cls2+'-placeholder,'+cls2+'-label,'+cls2+'-input',function(e){if(!config.disabled){if(config.dirsource){e.preventDefault();e.stopPropagation();self.element.find(cls2+'-control').trigger('click')}else input.focus()}});self.event('click',cls2+'-icon-left,'+cls2+'-icon-right',function(e){if(config.disabled)return;var el=$(this);var left=el.hclass(cls+'-icon-left');if(config.dirsource&&left&&config.liconclick){e.preventDefault();e.stopPropagation()}if(left&&config.liconclick)EXEC(self.makepath(config.liconclick),self,el);else if(config.riconclick)EXEC(self.makepath(config.riconclick),self,el)})};self.curpos=function(pos){var el=input[0];if(el.createTextRange){var range=el.createTextRange();range.move('character',pos);range.select()}else if(el.selectionStart){el.focus();el.setSelectionRange(pos,pos)}};self.validate=function(value){if(!config.required||config.disabled)return true;if(config.dirsource)return!!value;if(customvalidator)return customvalidator(value);if(value==null)value=EMPTYARRAY;return value.length>0};self.offset=function(){var offset=self.element.offset();var control=self.find(cls2+'-control');var width=control.width()+2;return{left:offset.left,top:control.offset().top+control.height(),width:width}};self.setter=function(){if(skip)skip=false;else self.bindvalue()};self.appendval=function(value,custom){var cur=self.get()||EMPTYARRAY;var is=false,isfn=false,rawvalue=value;if(dirsource&&typeof(dirsource)==='function'){isfn=true;rawvalue=value[config.dirvalue];if(cur.indexOf(rawvalue)!==-1||!self.checkvalue(rawvalue))return}else{rawvalue=self.transform(rawvalue);if(cur.indexOf(rawvalue)!==-1||!self.checkvalue(rawvalue))return}if(config.dirsource){if(custom){is=true;self.appendtag(rawvalue)}else{if(isfn){is=true;self.appendtag(value[config.dirkey])}else{var item=dirsource.findItem(config.dirvalue,rawvalue);if(item){is=true;self.appendtag(item[config.dirkey])}}}}else{is=true;self.appendtag(rawvalue)}if(is){skip=true;self.push(rawvalue);self.change(true)}self.check();self.dirinitchecksum=0};self.appendtag=function(text){input.before('<span class="{0}-tag"><i class="fa fa-times"></i>{1}</span>'.format(cls,Thelpers.encode(text)))};self.removetag=function(index){skip=true;tags.find('span').eq(index).remove();self.get().splice(index,1);self.update(true);self.change(true);self.check()};self.checkvalue=function(val){return config.check?GET(self.makepath(config.check))(val):true};self.check=function(){var is=!!input[0].innerHTML||(self.get()||EMPTYARRAY).length>0;setTimeout(self.resize,10);if(binded===is)return;binded=is;placeholder&&placeholder.tclass('hidden',is);self.tclass(cls+'-binded',is);if(config.type==='search')self.find(cls2+'-icon-right').find('i').tclass(config.ricon,!is).tclass('fa-times',is)};self.dirinitchecksum=0;self.bindvalue=function(){var value=self.get()||EMPTYARRAY;var tmp=HASH(value);if(tmp===self.dirinitchecksum)return;self.dirinitchecksum=tmp;tags.find(cls2+'-tag').remove();if(dirsource){if(typeof(dirsource)==='function'){EXEC(self.makepath(config.dirinit),value,function(dirsource){var item;for(var i=0;i<dirsource.length;i++){item=dirsource[i];item.name=self.transform(item.name);if(value.indexOf(item[config.dirvalue||config.value])!=-1)self.appendtag(item[config.dirkey||config.key])}input.empty();self.check()});return}var arr=[],item;for(var i=0;i<dirsource.length;i++){item=dirsource[i];item.name=self.transform(item.name);if(typeof(item)==='string'){if(value.indexOf(item)===-1)continue;arr.push(item)}else if(value.indexOf(item[config.dirvalue||config.value])!=-1)arr.push(item[config.dirkey||config.key])}for(var i=0;i<arr.length;i++){item=arr[i];item&&self.appendtag(item)}}else{for(var i=0;i<value.length;i++){value[i]=self.transform(value[i]);value[i]&&self.appendtag(value[i])}}input.empty();self.check()};self.resize=function(){var h=self.find(cls2+'-input').innerHeight()+'px';self.find('.{0}-icon-right,.{0}-icon-left'.format(cls)).css({height:h,'line-height':h})};self.redraw=function(){if(!config.ricon){if(config.dirsource)config.ricon='angle-down'}self.html(W.ui_inputtags_template(config));input=self.find(cls2+'-editable');tags=self.find(cls2+'-tags');placeholder=self.find(cls2+'-placeholder');input.on('paste',function(e){e.preventDefault();e.stopPropagation();var text=e.originalEvent.clipboardData.getData(self.attrd('clipboard')||'text/plain');text&&document.execCommand('insertText',false,text)});input.on('keydown',function(e){var el;if(e.which===13){e.preventDefault();e.stopPropagation();el=$(this);setTimeout(function(){var val=el.text();val&&self.appendval(val);el.html('')},100)}else if(e.which===8){if(!this.innerHTML){var prev=$(this).prev();prev.length&&self.removetag(prev.index())}}})};self.configure=function(key,value){switch(key){case'dirsource':var tmp=GET(self.makepath(value));input.prop('contenteditable',!value);if(typeof(tmp)!=='function'){self.datasource(value,function(path,value){dirsource=value||EMPTYARRAY;self.bindvalue()})}else dirsource=tmp;break;case'disabled':self.tclass('ui-disabled',value==true);input.attr('contenteditable',!value);self.reset();break;case'required':self.tclass(cls+'-required',value==true);self.reset();break;case'validate':customvalidator=value?(/\(|=|>|<|\+|-|\)/).test(value)?FN('value=>'+value):(function(path){return function(value){return GET(path)(value)}})(value):null;break;case'innerlabel':self.tclass(cls+'-inner',value);break}};self.formatter(function(path,value){if(value){switch(config.type){case'lower':return value.toString().toLowerCase();case'upper':return value.toString().toUpperCase()}}return value});self.parser(function(path,value){if(value){switch(config.type){case'lower':value=value.toLowerCase();break;case'upper':value=value.toUpperCase();break}}return value?config.spaces===false?value.replace(/\s/g,''):value:value});self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid);config.error&&self.find(cls2+'-error').tclass('hidden',!invalid)};self.transform=function(string){if(typeof string!=='string')return string;switch(config.transform){case 1:return string.toLowerCase();case 2:return string.toUpperCase();case 3:return self.capitalize(string)}return string};self.capitalize=function(string){return string.toLowerCase().replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})}});
// End: j-InputTags

// Component: j-FloatingInput
// Version: 1
// Updated: 2021-08-24 01:30
COMPONENT('floatinginput','minwidth:200',function(self,config,cls){var cls2='.'+cls,timeout,icon,plus,input,summary,area,is=false,plusvisible=false;self.readonly();self.singleton();self.nocompile&&self.nocompile();self.configure=function(key,value,init){if(init)return;switch(key){case'placeholder':self.find('input').prop('placeholder',value);break}};self.make=function(){self.aclass(cls+' hidden');self.append('<div class="{1}-summary hidden"></div><div class="{1}-input"><span class="{1}-add hidden"><i class="fa fa-plus"></i></span><span class="{1}-button"><i class="fa fa-pencil"></i></span><div class="{1}-control"><input type="text" placeholder="{0}" name="dir{2}" autocomplete="dir{2}" /><textarea name="dirt{2}" placeholder="{0}"></textarea></div></div'.format(config.placeholder,cls,Date.now()));input=self.find('input');icon=self.find(cls2+'-button').find('i');plus=self.find(cls2+'-add');summary=self.find(cls2+'-summary');area=self.find('textarea');self.event('click',cls2+'-button',function(e){input.val('');area.val('');e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-add',function(){if(self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);self.opt.callback(self.opt.multiline?area.val():input.val(),self.opt.element,true);self.hide()}});self.event('keydown','input,textarea',function(e){switch(e.which){case 27:self.hide();break;case 13:if(!self.opt.multiline){if(self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);self.opt.callback(this.value,self.opt.element)}self.hide()}break}});var e_click=function(e){var node=e.target,count=0;if(is){while(true){var c=node.getAttribute('class')||'';if(c.indexOf(cls+'-input')!==-1)return;node=node.parentNode;if(!node||!node.tagName||node.tagName==='BODY'||count>3)break;count++}}else{is=true;while(true){var c=node.getAttribute('class')||'';if(c.indexOf(cls)!==-1){is=false;break}node=node.parentNode;if(!node||!node.tagName||node.tagName==='BODY'||count>4)break;count++}}is&&self.hide(0)};var e_resize=function(){is&&self.hide(0)};self.bindedevents=false;self.bindevents=function(){if(!self.bindedevents){$(document).on('click',e_click);$(W).on('resize',e_resize);self.bindedevents=true}};self.unbindevents=function(){if(self.bindedevents){self.bindedevents=false;$(document).off('click',e_click);$(W).off('resize',e_resize)}};self.event('input','input,textarea',function(){var is=!!this.value;if(plusvisible!==is){plusvisible=is;plus.tclass('hidden',!this.value)}});var fn=function(){is&&self.hide(1)};self.on('reflow + scroll + resize + resize2',fn)};self.show=function(opt){var el=opt.element instanceof jQuery?opt.element[0]:opt.element;self.tclass(cls+'-default',!opt.render);if(!opt.minwidth)opt.minwidth=200;if(is){clearTimeout(timeout);if(self.target===el){self.hide(1);return}}self.initializing=true;self.target=el;plusvisible=false;var element=$(opt.element);setTimeout(self.bindevents,500);self.opt=opt;opt.class&&self.aclass(opt.class);if(opt.multiline){area.val(opt.value||'');area.prop('maxlength',opt.maxlength||1000);input.val('')}else{input.val(opt.value||'');input.prop('maxlength',opt.maxlength||100);area.val('')}self.target=element[0];var w=element.width();var offset=element.offset();var width=w+(opt.offsetWidth||0);if(opt.minwidth&&width<opt.minwidth)width=opt.minwidth;else if(opt.maxwidth&&width>opt.maxwidth)width=opt.maxwidth;var ico=opt.icon?self.faicon(opt.icon):'fa fa-pencil-alt';icon.rclass2('fa').aclass(ico).rclass('hidden');if(opt.value){plusvisible=true;plus.rclass('hidden')}else plus.aclass('hidden');var tmp=opt.multiline?area:input;tmp.prop('placeholder',opt.placeholder||config.placeholder);var options={left:0,top:0,width:width};summary.tclass('hidden',!opt.summary).html(opt.summary||'');switch(opt.align){case'center':options.left=Math.ceil((offset.left+w/2)-(width/2));break;case'right':options.left=(offset.left-width)+w;break;default:options.left=offset.left;break}options.top=opt.position==='bottom'?((offset.top-self.height())+element.height()):offset.top;options.scope=M.scope?M.scope():'';area.tclass('hidden',opt.multiline!=true);input.tclass('hidden',opt.multiline==true);self.tclass(cls+'-multiline',opt.multiline==true);if(opt.multiline)area.css('height',(typeof(opt.height)==='number'?(opt.height+'px'):opt.height)||'100px');if(opt.offsetX)options.left+=opt.offsetX;if(opt.offsetY)options.top+=opt.offsetY;self.css(options);!isMOBILE&&setTimeout(function(){opt.select&&tmp[0].select();tmp.focus()},200);self.tclass(cls+'-monospace',!!opt.monospace);self.rclass('hidden');setTimeout(function(){self.initializing=false;is=true;if(self.opt&&self.target&&self.target.offsetParent)self.aclass(cls+'-visible');else self.hide(1)},100)};self.hide=function(sleep){if(!is||self.initializing)return;clearTimeout(timeout);timeout=setTimeout(function(){self.unbindevents();self.rclass(cls+'-visible').aclass('hidden');if(self.opt){self.opt.close&&self.opt.close();self.opt.class&&self.rclass(self.opt.class);self.opt=null}is=false},sleep?sleep:100)}});
// End: j-FloatingInput

// Component: j-ToggleButton
// Version: 1
// Updated: 2019-10-04 20:07
COMPONENT('togglebutton',function(self,config,cls){var icon;self.nocompile();self.validate=function(value){return(config.disabled||!config.required)?true:value===true};self.configure=function(key,value,init){switch(key){case'disabled':!init&&self.tclass('ui-disabled',value);break;case'icontrue':case'iconfalse':if(value.indexOf(' ')===-1)config[key]='fa fa-'+value;break}};self.make=function(){self.aclass(cls);self.append('<button><i></i></button>');icon=self.find('i');self.event('click',function(){if(!config.disabled){self.dirty(false);self.getter(!self.get())}})};self.setter=function(value){self.tclass(cls+'-selected',value===true);icon.rclass();if(value===true){if(config.icontrue)icon.aclass(config.icontrue)}else{if(config.iconfalse)icon.aclass(config.iconfalse)}};self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)}});
// End: j-ToggleButton

// Component: j-Part
// Version: 1
// Updated: 2021-10-06 21:58
COMPONENT('part','hide:1;loading:1;delay:500',function(self,config,cls){var init=false,clid=null,downloading=false,isresizing=false,cache={};self.releasemode&&self.releasemode('true');self.readonly();self.make=function(){self.aclass(cls)};self.resize=function(){if(config.absolute){var pos=self.element.position();var obj={};obj.width=WW-pos.left;obj.height=WH-pos.top;self.css(obj)}};var replace=function(value){return value.replace(/\?/g,config.path||config.if)};self.setter=function(value){if(cache[value]){if(downloading)return;if(config.absolute&&!isresizing){self.on('resize2',self.resize);isresizing=true}if(self.dom.hasChildNodes()){if(clid){clearTimeout(clid);clid=null}self.release(false);var done=function(){config.hide&&self.rclass('hidden');config.reload&&EXEC(replace(config.reload));config.default&&DEFAULT(replace(config.default),true);var invisible=self.hclass('invisible');invisible&&self.rclass('invisible',config.delay);isresizing&&setTimeout(self.resize,50);setTimeout(self.emitresize,200);config.autofocus&&self.autofocus(config.autofocus)};if(config.check)EXEC(replace(config.check),done);else done()}else{config.loading&&SETTER('loading/show');downloading=true;setTimeout(function(){var preparator;if(config.replace)preparator=GET(replace(config.replace));else{preparator=function(content){return content.replace(/~PATH~/g,replace(config.path||config.if))}}self.import(replace(config.url),function(){if(!init){config.init&&EXEC(replace(config.init));init=true}var done=function(){config.hide&&self.rclass('hidden');self.release(false);config.reload&&EXEC(replace(config.reload),true);config.default&&DEFAULT(replace(config.default),true);config.loading&&SETTER('loading/hide',self.delay);var invisible=self.hclass('invisible');invisible&&self.rclass('invisible',self.delay);isresizing&&setTimeout(self.resize,50);setTimeout(self.emitresize,200);downloading=false;config.autofocus&&self.autofocus(config.autofocus)};EMIT('parts.'+config.if,self.element,self);if(config.check)EXEC(replace(config.check),done);else done()},true,preparator)},200)}}else{if(!self.hclass('hidden')){config.hidden&&EXEC(replace(config.hidden));config.hide&&self.aclass('hidden'+(config.invisible?' invisible':''));self.release(true)}if(config.cleaner&&init&&!clid)clid=setTimeout(self.clean,config.cleaner*60000)}};self.emitresize=function(){self.element.SETTER('*','resize')};self.configure=function(key,value){switch(key){case'if':var tmp=(value+'').split(',').trim();cache={};for(var i=0;i<tmp.length;i++)cache[tmp[i]]=1;break;case'absolute':var is=!!value;self.tclass(cls+'-absolute',is);break}};self.clean=function(){if(self.hclass('hidden')){config.clean&&EXEC(replace(config.clean));setTimeout(function(){self.empty();init=false;clid=null;setTimeout(FREE,1000)},1000)}}});
// End: j-Part

// Component: j-Selected
// Version: 1
// Updated: 2021-08-31 16:43
COMPONENT('selected','class:selected;selector:a;attr:if;attror:or;delay:50',function(self,config){self.readonly();self.refresh2=function(){self.refreshid=null;self.refresh()};self.configure=function(key,value){switch(key){case'datasource':self.datasource(value,function(){self.refreshid&&clearTimeout(self.refreshid);self.refreshid=setTimeout(self.refresh2,config.delay)});break}};self.setter=function(value){var cls=config.class;self.find(config.selector).each(function(){var el=$(this);var or=el.attrd(config.attror)||'';if(el.attrd(config.attr)===value||(or&&or.indexOf(value)!==-1))el.aclass(cls);else el.hclass(cls)&&el.rclass(cls)})}});
// End: j-Selected

// Component: Tangular-FileSize
// Version: 1
// Updated: 2018-11-03 22:40
Thelpers.filesize=function(value,decimals,type){return value?value.filesize(decimals,type):'...'};Number.prototype.filesize=function(decimals,type){if(typeof(decimals)==='string'){var tmp=type;type=decimals;decimals=tmp}var value,t=this;switch(type){case'bytes':value=t;break;case'KB':value=t/1024;break;case'MB':value=filesizehelper(t,2);break;case'GB':value=filesizehelper(t,3);break;case'TB':value=filesizehelper(t,4);break;default:type='bytes';value=t;if(value>1023){value=value/1024;type='KB'}if(value>1023){value=value/1024;type='MB'}if(value>1023){value=value/1024;type='GB'}if(value>1023){value=value/1024;type='TB'}break}type=' '+type;return(decimals===undefined?value.format(2).replace('.00',''):value.format(decimals))+type};function filesizehelper(number,count){while(count--){number=number/1024;if(number.toFixed(3)==='0.000')return 0}return number}
// End: Tangular-FileSize

// Component: j-LargeForm
// Version: 1
// Updated: 2021-10-06 21:15
COMPONENT('largeform','zindex:12;padding:30;scrollbar:1;scrolltop:1;style:1',function(self,config,cls){var cls2='.'+cls,csspos={},nav=false,init=false;if(!W.$$largeform){W.$$largeform_level=W.$$largeform_level||1;W.$$largeform=true;$(document).on('click',cls2+'-button-close',function(){SET($(this).attrd('path'),'')});var resize=function(){setTimeout2(self.name,function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='largeform'&&!HIDDEN(com.dom)&&com.$ready&&!com.$removed)com.resize()}},200)};ON('resize2',resize);$(document).on('click',cls2+'-container',function(e){if(e.target===this){var com=$(this).component();if(com&&com.config.closeoutside){com.set('');return}}var el=$(e.target);if(el.hclass(cls+'-container')&&!el.hclass(cls+'-style-2')){var form=el.find(cls2);var c=cls+'-animate-click';form.aclass(c);setTimeout(function(){form.rclass(c)},300)}})}self.readonly();self.submit=function(){if(config.submit)self.EXEC(config.submit,self.hide,self.element);else self.hide()};self.cancel=function(){config.cancel&&self.EXEC(config.cancel,self.hide);self.hide()};self.hide=function(){if(config.independent)self.hideforce();self.set('')};self.icon=function(value){var el=this.rclass2('fa');value.icon&&el.aclass(value.icon.indexOf(' ')===-1?('fa fa-'+value.icon):value.icon)};self.resize=function(){if(self.hclass('hidden'))return;var padding=isMOBILE?0:config.padding,ui=self.find(cls2);csspos.height=WH-(config.style==1?(padding*2):padding);csspos.top=padding;ui.css(csspos);var el=self.find(cls2+'-title');var th=el.height();var w=ui.width();if(w>WW)w=WW;csspos={height:csspos.height-th,width:w};if(nav)csspos.height-=nav.height();self.find(cls2+'-body').css(csspos);self.scrollbar&&self.scrollbar.resize();self.element.SETTER('*','resize')};self.make=function(){$(document.body).append('<div id="{0}" class="hidden {4}-container invisible"><div class="{4}" style="max-width:{1}px"><div data-bind="@config__text span:value.title__change .{4}-icon:@icon" class="{4}-title"><button name="cancel" class="{4}-button-close{3}" data-path="{2}"><i class="fa fa-times"></i></button><i class="{4}-icon"></i><span></span></div><div class="{4}-body"></div></div>'.format(self.ID,config.width||800,self.path,config.closebutton==false?' hidden':'',cls));var scr=self.find('> script');self.template=scr.length?scr.html().trim():'';scr.length&&scr.remove();var el=$('#'+self.ID);var body=el.find(cls2+'-body')[0];while(self.dom.children.length){var child=self.dom.children[0];if(child.tagName==='NAV'){nav=$(child);body.parentNode.appendChild(child)}else body.appendChild(child)}self.rclass('hidden invisible');self.replace(el,true);if(config.scrollbar)self.scrollbar=SCROLLBAR(self.find(cls2+'-body'),{shadow:config.scrollbarshadow,visibleY:config.visibleY,orientation:'y'});if(config.style===2)self.aclass(cls+'-style-2');self.event('scroll',function(){EMIT('scroll',self.name);EMIT('reflow',self.name)});self.event('click','button[name]',function(){var t=this;switch(t.name){case'submit':self.submit(self.hide);break;case'cancel':!t.disabled&&self[t.name](self.hide);break}});config.enter&&self.event('keydown','input',function(e){e.which===13&&!self.find('button[name="submit"]')[0].disabled&&setTimeout(self.submit,800)})};self.configure=function(key,value,init,prev){if(!init){switch(key){case'width':value!==prev&&self.find(cls2).css('max-width',value+'px');break;case'closebutton':self.find(cls2+'-button-close').tclass('hidden',value!==true);break}}};self.esc=function(bind){if(bind){if(!self.$esc){self.$esc=true;$(W).on('keydown',self.esc_keydown)}}else{if(self.$esc){self.$esc=false;$(W).off('keydown',self.esc_keydown)}}};self.esc_keydown=function(e){if(e.which===27&&!e.isPropagationStopped()){var val=self.get();if(!val||config.if===val){e.preventDefault();e.stopPropagation();self.hide()}}};self.hideforce=function(){if(!self.hclass('hidden')){self.aclass('hidden');self.release(true);self.esc(false);self.find(cls2).rclass(cls+'-animate');W.$$largeform_level--}};var allowscrollbars=function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)};self.setter=function(value){setTimeout2(self.name+'-noscroll',allowscrollbars,50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);config.scrolltop&&self.scrollbar&&self.scrollbar.scrollTop(0)}return}setTimeout2(cls,function(){EMIT('reflow',self.name)},10);if(isHidden){if(!config.independent)self.hideforce();return}if(self.template){var is=self.template.COMPILABLE();self.find(cls2).append(self.template);self.template=null;is&&COMPILE()}if(W.$$largeform_level<1)W.$$largeform_level=1;W.$$largeform_level++;self.css('z-index',W.$$largeform_level*config.zindex);self.aclass('invisible');self.rclass('hidden');self.release(false);config.scrolltop&&self.scrollbar&&self.scrollbar.scrollTop(0);config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);self.resize();setTimeout(function(){self.rclass('invisible');self.find(cls2).aclass(cls+'-animate');if(!init&&isMOBILE){$('body').aclass('hidden');setTimeout(function(){$('body').rclass('hidden')},50)}config.autofocus&&self.autofocus(config.autofocus);init=true},200);setTimeout2(self.ID,function(){self.css('z-index',(W.$$largeform_level*config.zindex)+1)},500);config.closeesc&&self.esc(true)}});
// End: j-LargeForm

// Component: j-NavLayout
// Version: 1
// Updated: 2021-05-18 12:33
COMPONENT('navlayout','parent:window;autoresize:1;margin:0;width:250;hide:xs,sm;position:left',function(self,config,cls){var cls2='.'+cls,main,section,init=false;self.readonly();self.init=function(){ON('resize + resize2',function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='navlayout'&&com.dom.offsetParent&&com.$ready&&!com.$removed&&com.config.autoresize)com.resize()}})};self.make=function(){self.aclass(cls);for(var i=0;i<self.dom.children.length;i++){var el=self.dom.children[i];switch(el.tagName){case'SECTION':section=$(el);break;case'MAIN':main=$(el);break}}self.resize()};self.configure=function(key,value,init){switch(key){case'hide':var arr=value.split(',');if(!init)self.rclass2(cls2+'-d-');for(var i=0;i<arr.length;i++)self.aclass(cls+'-d-'+arr[i]);break;case'position':self.rclass(cls+'-left '+cls+'-right').aclass(cls+'-'+config.position);break;case'width':var css={};css.width=config.width;section.css(css);css={};css['margin-left']=config.position==='left'?config.width:'';css['margin-right']=config.position==='right'?config.width:'';main.css(css);break}};self.resize=function(){setTimeout2(self.ID,self.resizeforce,100)};self.resizeforce=function(){var parent=self.parent(config.parent);var height=parent.height()-config.margin;var css={};css.height=height;self.css(css);section.css(css);main.css(css);if(!init){var arr=[self.element,main,section];for(var i=0;i<arr.length;i++)arr[i].rclass('invisible hidden',100);init=true}};self.setter=function(value){self.tclass(cls+'-show',!!value)}});
// End: j-NavLayout

// Component: j-FileReader
// Version: 1
// Updated: 2021-10-05 17:47
COMPONENT('filereader',function(self){var input;self.readonly();self.nocompile();self.singleton();self.make=function(){self.aclass('hidden');self.append('<input type="file" />');input=self.find('input');input.on('change',function(e){self.process(e.target.files)})};self.open=function(opt,callback){self.opt=opt;if(!opt.callback)opt.callback=callback;input.attr('accept',opt.accept||'*/*').prop('multiple',!!opt.multiple);input.trigger('click')};self.process=function(files){SETTER('loading','show');var arr=[];for(var i=0;i<files.length;i++)arr.push(i);arr.wait(function(index,next){var file=files[index],reader=new FileReader();reader.onload=function(){var data={body:reader.result,filename:file.name,type:file.type,size:file.size};if(self.opt.callback)self.opt.callback(data);else self.set(data);reader=null;setTimeout(next,500)};reader.readAsText(file)},function(){SETTER('loading','hide',1000);input[0].value=''})}});
// End: j-FileReader

// Component: j-Message
// Version: 1
// Updated: 2021-04-20 15:52
COMPONENT('message','button:OK',function(self,config,cls){var cls2='.'+cls,is,events={};self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){var pls=(config.style===2?(' '+cls+'2'):'');self.aclass(cls+' hidden'+pls);if(config.closeoutside)self.event('click',function(e){var node=e.target,skip={SPAN:1,A:1,I:1};if(!skip[node.tagName])self.hide()});else self.event('click','button',self.hide)};events.keyup=function(e){if(e.which===27)self.hide()};events.bind=function(){if(!events.is){$(W).on('keyup',events.keyup);events.is=false}};events.unbind=function(){if(events.is){events.is=false;$(W).off('keyup',events.keyup)}};self.warning=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content(cls+'-warning',message,icon||'warning')};self.info=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content(cls+'-info',message,icon||'info-circle')};self.success=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content(cls+'-success',message,icon||'check-circle')};self.response=function(message,callback,response){var fn;if(typeof(message)==='function'){response=callback;fn=message;message=null}else if(typeof(callback)==='function')fn=callback;else{response=callback;fn=null}if(response instanceof Array){var builder=[];for(var i=0;i<response.length;i++){var err=response[i].error;err&&builder.push(err)}self.warning(builder.join('<br />'));SETTER('!loading/hide')}else if(typeof(response)==='string'){self.warning(response);SETTER('!loading/hide')}else{if(message){if(message.length<40&&message.charAt(0)==='?')SET(message,response);else self.success(message)}if(typeof(fn)==='string')SET(fn,response);else if(fn)fn(response)}};self.hide=function(){events.unbind();self.callback&&self.callback();self.aclass('hidden')};self.content=function(classname,text,icon){if(icon.indexOf(' ')===-1)icon='fa fa-'+icon;!is&&self.html('<div><div class="{0}-icon"><i class="{1}"></i></div><div class="{0}-body"><div class="{0}-text"></div><hr /><button>{2}</button></div></div>'.format(cls,icon,config.button));self.rclass2(cls+'-').aclass(classname);self.find(cls2+'-body').rclass().aclass(cls+'-body');is&&self.find(cls2+'-icon').find('.fa').rclass2('fa').aclass(icon);self.find(cls2+'-text').html(text);self.rclass('hidden');self.element.focus();is=true;events.bind();document.activeElement&&document.activeElement.blur();setTimeout(function(){self.aclass(cls+'-visible');setTimeout(function(){self.find(cls2+'-icon').aclass(cls+'-icon-animate');document.activeElement&&document.activeElement.blur()},300)},100)}});
// End: j-Message

// Component: j-Approve
// Version: 1
// Updated: 2021-02-11 09:41
COMPONENT('approve','cancel:Cancel',function(self,config,cls){var cls2='.'+cls,events={},buttons,oldcancel;self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+' hidden');self.html('<div><div class="{0}-body"><span class="{0}-close"><i class="fa fa-times"></i></span><div class="{0}-content"></div><div class="{0}-buttons"><button data-index="0"></button><button data-index="1"></button></div></div></div>'.format(cls));buttons=self.find(cls2+'-buttons').find('button');self.event('click','button',function(){self.hide(+$(this).attrd('index'))});self.event('click',cls2+'-close',function(){self.callback=null;self.hide(-1)});self.event('click',function(e){var t=e.target.tagName;if(t!=='DIV')return;var el=self.find(cls2+'-body');el.aclass(cls+'-click');setTimeout(function(){el.rclass(cls+'-click')},300)})};events.keydown=function(e){var index=e.which===13?0:e.which===27?1:null;if(index!=null){self.find('button[data-index="{0}"]'.format(index)).trigger('click');e.preventDefault();e.stopPropagation();events.unbind()}};events.bind=function(){$(W).on('keydown',events.keydown)};events.unbind=function(){$(W).off('keydown',events.keydown)};self.show=function(message,a,b,fn){if(typeof(b)==='function'){fn=b;b=config.cancel}if(M.scope)self.currscope=M.scope();self.callback=fn;var icon=a.match(/"[a-z0-9-\s]+"/);if(icon){var tmp=icon+'';if(tmp.indexOf(' ')==-1)tmp='fa fa-'+tmp;a=a.replace(icon,'').trim();icon='<i class="{0}"></i>'.format(tmp.replace(/"/g,''))}else icon='';var color=a.match(/#[0-9a-f]+/i);if(color)a=a.replace(color,'').trim();buttons.eq(0).css('background-color',color||'').html(icon+a);if(oldcancel!==b){oldcancel=b;buttons.eq(1).html(b)}self.find(cls2+'-content').html(message.replace(/\n/g,'<br />'));$('html').aclass(cls+'-noscroll');self.rclass('hidden');events.bind();self.aclass(cls+'-visible',5);document.activeElement&&document.activeElement.blur()};self.hide=function(index){if(!index){self.currscope&&M.scope(self.currscope);self.callback&&self.callback(index)}self.rclass(cls+'-visible');events.unbind();setTimeout2(self.id,function(){$('html').rclass(cls+'-noscroll');self.aclass('hidden')},1000)}});
// End: j-Approve

// Component: Tangular-Color
// Version: 1
// Updated: 2020-02-20 16:37
Thelpers.color=function(value){var hash=HASH(value,true);var color='#';for(var i=0;i<3;i++){var value=(hash>>(i*8))&0xFF;color+=('00'+value.toString(16)).substr(-2)}return color};
// End: Tangular-Color

// Component: Tangular-Counter
// Version: 1
// Updated: 2021-04-06 12:52
Thelpers.counter=function(value,decimals){if(decimals==null)decimals=0;if(value>999999)return(value/1000000).format(decimals)+' M';if(value>9999)return(value/1000).format(decimals)+' K';return value.format(decimals)};
// End: Tangular-Counter

// Component: j-FileUploader
// Version: 1
// Updated: 2021-08-06 22:42
COMPONENT('fileuploader',function(self){var input;self.singleton();self.readonly();self.nocompile();self.upload=self.browse=function(opt){self.opt=opt;if(opt.files){self.uploadfiles(opt.files)}else{self.find('input').attr('accept',opt.accept||'*/*').prop('multiple',!!opt.multiple);input[0].value='';input.click()}};self.make=function(){self.aclass('hidden');self.append('<input type="file" multiple />');input=self.find('input');self.event('change','input',function(e){self.uploadfiles(e.target.files);this.value=''})};self.uploadfiles=function(files){var data=new FormData();for(var i=0;i<files.length;i++){var filename=files[i].name,index=filename.lastIndexOf('/');if(index===-1)index=filename.lastIndexOf('\\');if(index!==-1)filename=filename.substring(index+1);data.append((self.opt.prefix||'file{0}').format(i),files[i],filename)}if(self.opt.data){for(var key in self.opt.data)data.append(key,self.opt.data[key])}SETTER('loading/show');UPLOAD(self.opt.url,data,function(response,err){input[0].value='';SETTER('loading/hide',500);if(!response&&err)self.opt.callback(null,err);else if(response instanceof Array&&response[0]&&response[0].error)self.opt.callback(null,response[0].error);else self.opt.callback(response)},self.opt.progress)}});
// End: j-FileUploader

// Component: j-Loading
// Version: 1
// Updated: 2021-02-11 09:46
COMPONENT('loading',function(self,config,cls){var delay,prev;self.readonly();self.singleton();self.nocompile();self.make=function(){self.aclass(cls+' '+cls+'-'+(config.style||1));self.append('<div><div class="'+cls+'-text hellip"></div></div>')};self.show=function(text){clearTimeout(delay);if(prev!==text){prev=text;self.find('.'+cls+'-text').html(text||'')}self.rclass('hidden');document.activeElement&&document.activeElement.blur();return self};self.hide=function(timeout){clearTimeout(delay);delay=setTimeout(function(){self.aclass('hidden')},timeout||1);return self}});
// End: j-Loading

// Component: j-Wiki
// Version: 1
// Updated: 2021-03-14 13:36
COMPONENT('wiki','title:Wiki;margin:20;width:400',function(self,config,cls){var cls2='.'+cls,etopics,container;self.singleton();self.readonly();self.make=function(){self.css('max-width',config.width);self.aclass(cls+' hidden');self.append('<div class="{0}-title"><button><i class="fa fa-times"></i></button><span></span></div><div class="{0}-topics"><div class="{0}-topics-body markdown-small"></div></div>'.format(cls));etopics=self.find(cls2+'-topics-body');container=self.find(cls2+'-topics');self.scrollbar=SCROLLBAR(self.find(cls2+'-topics'),{visibleY:!!config.scrollbarY,orientation:'y'});self.scrollleft=self.scrollbar.scrollLeft;self.scrolltop=self.scrollbar.scrollTop;self.scrollright=self.scrollbar.scrollRight;self.scrollbottom=self.scrollbar.scrollBottom;self.on('resize2',self.resize);self.resize();self.event('click','label',function(){var el=$(this);var index=+el.attrd('index');var parent=el.parent();parent.tclass(cls+'-visible');if(parent.hclass(cls+'-visible')){el=parent.find(cls2+'-topic-body');if(!el.html().length){var item=GET(self.makepath(config.datasource))[index];el.html(item?(item.body||'').markdown():'')}}self.scrollbar.resize()});self.event('click','button',function(){self.set(false)})};self.resize=function(){var offset=self.element.offset();var header=self.element.find(cls2+'-title').height();container.css('height',WH-header-offset.top-config.margin-1);self.scrollbar.resize()};self.rebind=function(path,value){var builder=[],template='<div class="{0}-topic"><label data-index="{1}"><i class="fa"></i>{2}</label><div class="{0}-topic-body"></div></div>';for(var i=0;i<(value||EMPTYARRAY).length;i++)builder.push(template.format(cls,i,value[i].name));etopics.html(builder.join(''));self.resize()};self.configure=function(key,value){if(key==='datasource')self.datasource(value,self.rebind);else if(key==='title')self.find(cls2+'-title span').html(value)};self.setter=function(value){self.tclass('hidden',!value);if(value){self.resize();setTimeout(self.resize,1000)}}},['https://cdn.componentator.com/highlight.min@914.js','https://cdn.componentator.com/apexcharts.min@310.js']);
// End: j-Wiki

// Component: j-Configuration
// Version: 1
// Updated: 2021-10-11 02:05
COMPONENT('configuration','dateformat:yyyy-MM-dd',function(self,config,cls){var cls2='.'+cls,datasource,items=EMPTYARRAY;self.validate=function(value){if(config.disabled)return true;if(!value)value=EMPTYOBJECT;var errors=[];for(var i=0;i<items.length;i++){var item=items[i];if(item.required&&item.isdisabled!==true&&item.isvisible!==false){var val=value[item.name],is=item.validate(item.prepare(val));item.element.tclass(cls+'-invalid',!is);if(!is)errors.push(item)}}return!errors.length};self.reload=function(){var model=self.get();var prev;for(var i=0;i<items.length;i++){var item=items[i];item.$disable&&item.disable(item.$disable(model||EMPTYOBJECT));var is=true;if(item.$visible){is=item.$visible(model||EMPTYOBJECT);item.element.tclass('hidden',!is)}if(item.element[0].getAttribute('class').indexOf(cls+'-last')!==-1)item.element.rclass(cls+'-last');if(prev&&prev.group!==item.group)prev.element.aclass(cls+'-last');if(is)prev=item}if(prev)prev.element.aclass(cls+'-last')};self.types={};self.types.template=function(item){var icon='';if(item.icon)icon='<i class="'+self.faicon(item.icon)+'"></i>';var builder=[],align=item.align||0;if(align==='center')align=1;else if(align==='right')align=2;builder.push('<div class="{0}-item{1}">'.format(cls,align?(' '+cls+'-align-'+align):''));builder.push('<div class="{0}-item-label">{1}{2}</div>'.format(cls,icon,item.text));item.summary&&builder.push('<div class="{0}-item-summary">{1}</div>'.format(cls,item.summary));builder.push('<div class="{0}-item-control"></div>'.format(cls));item.note&&builder.push('<div class="{0}-item-note">{1}</div>'.format(cls,item.note));item.button&&builder.push('<div class="{0}-button"><button>{1}</button></div>'.format(cls,item.button));item.html&&builder.push(item.html);builder.push('</div>');var T,get=function(){var model=self.get()||EMPTYOBJECT;return model[item.name]};var set=function(val){var model=self.get();var empty=false;if(!model){empty=true;model={}}var old=model[item.name];val=T.prepare(val);if(old!=val){model[item.name]=val;if(empty)SET(self.path,model);else UPD(self.path+'.'+item.name,2);self.change(true);return true}};var el=$(builder.join(''));item.required&&el.aclass(cls+'-required');var control=el.find(cls2+'-item-control');var type=self.types[item.type](item,control,set,get);T=type;type.element=el;type.control=control;type.name=item.name;type.required=item.required;var fndisable=item.disable?FN(item.disable):null;if(fndisable){type.$disable=function(model){var is=!!fndisable(model);item.button&&type.element.find(cls2+'-button button').prop('disabled',is);type.isdisabled=is;return is}}else{type.$disable=null;type.isdisabled=false}var fnvisible=item.visible?FN(item.visible):null;if(fnvisible){type.$visible=function(model){var is=!!fnvisible(model);type.isvisible=is;return is}}else{type.$visible=null;type.isvisible=true}item.noborder&&el.aclass(cls+'-noborder');item.click&&el.find(cls2+'-button button').on('click',function(){var meta={};meta.item=item;meta.value=get();meta.set=set;meta.type=type;self.EXEC(item.click,meta)});return type};self.types.string=function(item,el,set,get){var obj={};obj.bind=function(val){var input=el.find('input');if(item.camouflage){var arr=[];for(var i=0;i<val.length;i++)arr.push('•');val=arr.join('')}input.val(val)};obj.validate=function(val){if(val==null)return false;if(item.transform==='email')return val.isEmail();if(item.transform==='phone')return val.isPhone();if(item.transform==='url')return val.isURL();return!!val};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('input').prop('disabled',!!val)};obj.prepare=function(val){if(val==null)return'';val=(val+'').trim();switch(item.transform){case'phone':case'url':return val.replace(/\s/g,'');case'email':case'lowercase':return val.toLowerCase();case'uppercase':return val.toUppercase();case'slug':return val.slug();case'id':return val.slug().replace(/-/g,'')}return val};el.append('<div class="{0}-type-string"{1}><input type="text" placeholder="{2}" /></div>'.format(cls,item.width?' style="max-width:{0}px"'.format(item.width):'',(item.placeholder||'').encode()));var input=el.find('input');item.maxlength&&input.prop('maxlength',item.maxlength);input.on('change',function(){set(this.value)}).blur(function(){if(item.camouflage)obj.bind(this.value)}).on('focus',function(){if(item.camouflage){var val=obj.prepare(get());this.value=val}});item.monospace&&input.aclass(cls+'-monospace');item.bold&&input.aclass('b');return obj};self.types.multiline=self.types.textarea=function(item,el,set){var obj={};obj.bind=function(val){el.find('input').val(val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('textarea').prop('disabled',!!val)};obj.prepare=function(val){return val!=null?(val+'').trim():''};el.append('<div class="{0}-type-multiline"{2}><textarea placeholder="{1}"></textarea></div>'.format(cls,(item.placeholder||'').encode(),item.height?' style="height:{0}"'.format(item.height):''));var input=el.find('textarea').on('change',function(){set(this.value)});item.monospace&&input.aclass(cls+'-monospace');item.bold&&input.aclass('b');return obj};self.types.group=function(item){var icon='';if(item.icon)icon='<i class="'+self.faicon(item.icon)+'"></i>';var builder=['<div>'];builder.push('<div class="{0}-group">{1}</div>'.format(cls,icon+item.text));if(item.summary)builder.push('<div class="{0}-group-summary">{1}</div>'.format(cls,item.summary));else builder.push('<br>');return builder.join('')+'</div>'};self.types.number=function(item,el,set,get){var obj={};obj.bind=function(val){el.find('input').val(val)};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('input').prop('disabled',!!val)};obj.validate=function(val){return val!=0};obj.prepare=function(val){if(val==null)return 0;if(item.min!=null&&val<item.min)val=item.min;else if(item.max!=null&&val>item.max)val=item.max;var type=typeof(val);return type==='string'?val.parseFloat():type==='number'?val:0};el.parent().aclass(cls+'-border');el.append('<div class="{0}-type-number"{1}><span><i class="fa fa-angle-up"></i><i class="fa fa-angle-down"></i></span><div><input type="text" placeholder="{2}" /></div></div>'.format(cls,item.width?' style="max-width:{0}px"'.format(item.width):'',(item.placeholder||'').encode()));var input=el.find('input');input.prop('maxlength',item.maxlength||12);input.on('change blur',function(){set(this.value)});item.monospace&&input.aclass(cls+'-monospace');item.bold&&item.aclass('b');el.find('span i').on('click',function(){if(input[0].disabled)return;var inc=item.increment||1,val=get()||0;if(this.getAttribute('class').indexOf('-up')!==-1){set(val+inc)}else{set(val-inc)}});return obj};self.types.boolean=self.types.checkbox=function(item,el,set){var tcls=cls+'-checked',obj={};obj.bind=function(val){el.tclass(tcls,!!val)};obj.validate=function(val){return val===true};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return!!val};el.parent().aclass(cls+'-border');el.append('<div class="{0}-type-boolean"><div><span><i class="fa fa-check"></i></span></div></div>'.format(cls));el.find(cls2+'-type-boolean > div').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){el.tclass(tcls);set(el.hclass(tcls))}});return obj};self.types.dropdown=function(item,el,set){var obj={};obj.bind=function(val){var items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));var obj=(items||EMPTYARRAY).findItem('id',val);el.find('label').tclass('hidden',!!obj);el.find(cls2+'-value').text(obj?obj.name:'')};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?null:val};el.append('<div class="{0}-type-dropdown"><span><i class="fa fa-angle-down"></i></span><label>{1}</label><div class="{0}-value"></div></div>'.format(cls,(item.placeholder||'').encode()));el.find(cls2+'-type-dropdown').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));var opt={};opt.element=$(this);opt.items=items;opt.placeholder=item.dirplaceholder;opt.search=item.dirsearch;opt.empty=item.dirempty;opt.callback=function(val){set(val?val.id:null)};SETTER('directory/show',opt)}});return obj};self.types.color=function(item,el,set){var obj={};obj.bind=function(val){el.find(cls2+'-type-color div').css('background-color',val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':(val+'')};el.append('<div class="{0}-type-color"><div></div></div>'.format(cls));el.find(cls2+'-type-color').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.element=$(this);opt.callback=set;SETTER('colorpicker/show',opt)}});return obj};self.types.icon=function(item,el,set){var obj={};obj.bind=function(val){el.find(cls2+'-type-icon').html('<i class="{0}"></i>'.format(val))};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':(val+'')};el.append('<div class="{0}-type-icon"></div>'.format(cls));el.find(cls2+'-type-icon').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.element=$(this);opt.callback=set;SETTER('faicons/show',opt)}});return obj};self.types.date=function(item,el,set,get){var obj={};obj.bind=function(val){el.find(cls2+'-value').html(val?val.format(item.format||DEF.dateformat||config.dateformat):'');el.find('label').tclass('hidden',!!val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){if(val==null)return null;var type=typeof(val);return type==='string'?val.parseDate():type==='number'?new Date(val):val instanceof Date?val:null};el.append('<div class="{0}-type-date"><span><i class="fa fa-calendar"></i></span><label>{1}</label><div class="{0}-value"></div></div>'.format(cls,(item.placeholder||'').encode()));el.find(cls2+'-type-date').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.value=get();opt.element=$(this);opt.callback=set;SETTER('datepicker/show',opt)}});return obj};self.types.selectable=function(item,el,set){var obj={},prev,items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));if(!(items instanceof Array))items=(items||EMPTYARRAY);obj.bind=function(val){var elements=el.find(cls2+'-type-selectable-item');el.find(cls2+'-selected').rclass(cls+'-selected');if(val instanceof Array){for(var i=0;i<val.length;i++){var index=items.findIndex('id',val[i]);if(index!==-1)elements.eq(index).aclass(cls+'-selected')}}else{var index=items.findIndex('id',val);if(index!==-1)elements.eq(index).aclass(cls+'-selected')}};obj.validate=function(val){return item.multiple?val&&val.length>0:!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':item.multiple&&val instanceof Array?val:(val+'')};var builder=[];for(var i=0;i<items.length;i++)builder.push('<div class="{0}-type-selectable-item"><i class="{icon}"></i><span>{name}</div>'.format(cls).arg(items[i]));el.append('<div class="{0}-type-selectable">{1}</div>'.format(cls,builder.join('')));el.find(cls2+'-type-selectable-item').on('click',function(){var selcls=cls+'-selected';if(!el.parent().hclass(cls+'-disabled')){var target=$(this);if(item.multiple){target.tclass(selcls)}else{if(prev&&prev[0]!==target[0])prev.rclass(selcls);prev=target.tclass(selcls)}var arr=el.find(cls2+'-selected');var selected=[];for(var i=0;i<arr.length;i++){var index=$(arr[i]).index();selected.push(items[index].id)}set(item.multiple?selected:(selected[0]||null))}});return obj};self.configure=function(key,value){if(key==='datasource'){self.datasource(value,function(path,value){datasource=value;self.redraw();self.refresh()},true)}};self.rebind=function(val){datasource=new Function('val','return '+val.trim())(val);self.redraw();self.refresh()};self.redraw=function(){items=[];self.empty();var container=self.element,was=false,group,count=0;for(var i=0;i<datasource.length;i++){var item=datasource[i];if(item.type==='group'){if(count&&!was)self.append('<br>');group=item;self.append(self.types.group(item));var div=document.createElement('DIV');self.append(div);container=$(div).aclass(cls+'-items')}else{count++;item=self.types.template(item);item.group=group;container.append(item.element);items.push(item)}}};self.make=function(){self.aclass(cls);var template=self.find('script').html();template&&self.rebind(template)};self.setter=function(value,path){if(!value)value={};var diff=path.substring(self.path.length+1);for(var key in value){var val=value[key];for(var j=0;j<items.length;j++){var item=items[j];if(item.name===key&&item.type!=='group'&&(!diff||diff.indexOf(path)===-1))item.bind(item.prepare(val))}}self.reload();self.rclass('invisible')}});
// End: j-Configuration

// Component: j-Markdown
// Version: 1
// Updated: 2021-05-10 12:15
COMPONENT('markdown',function(self){self.readonly();self.singleton();self.blind();self.nocompile();self.make=function(){setTimeout(function(){self.remove()},500);$(document).on('click','.markdown-showsecret,.markdown-showblock',function(){var el=$(this);var next=el.next();next.tclass('hidden');var is=next.hclass('hidden');var icons=el.find('i');if(el.hclass('markdown-showsecret')){icons.eq(0).tclass('fa-unlock',!is).tclass('fa-lock',is);icons.eq(1).tclass('fa-angle-up',!is).tclass('fa-angle-down',is)}else{icons.eq(0).tclass('fa-minus',!is).tclass('fa-plus',is);el.tclass('markdown-showblock-visible',!is)}el.find('b').html(el.attrd(is?'show':'hide'))})};(function Markdown(){var keywords=/\{.*?\}\(.*?\)/g;var linksexternal=/(https|http):\/\//;var format=/__.*?__|_.*?_|\*\*.*?\*\*|\*.*?\*|~~.*?~~|~.*?~/g,ordered=/^[a-z|0-9]{1}\.\s|^-\s/i,orderedsize=/^(\s|\t)+/;var code=/`.*?`/g,encodetags=/<|>/g,regdash=/-{2,}/g,regicons=/(^|[^\w]):((fab\s|far\s|fas\s|fal\s|fad|fa\s)fa-)?[a-z-]+:([^\w]|$)/g;var regemptychar=/\s|\W/,regtags=/<[^>]*>/g,encode=function(val){return'&'+(val==='<'?'lt':'gt')+';'};function markdown_code(value){return value?('<code>'+value.substring(1,value.length-1)+'</code>'):''}function markdown_imagelinks(value){if(!value)return'';var end=value.lastIndexOf(')')+1;var img=value.substring(0,end);var url=value.substring(end+2,value.length-1);var label=markdown_links(img);var footnote=label.substring(0,13);if(footnote==='<sup data-id='||footnote==='<span data-id'||label.substring(0,9)==='<a href="')return label;return'<a href="'+url+'"'+(linksexternal.test(url)?' target="_blank"':'')+'>'+label+'</a>'}function markdown_table(value,align,ishead){var columns=value.substring(1,value.length-1).split('|');var builder='';for(var i=0;i<columns.length;i++){var column=columns[i].trim();if(column.charAt(0)=='-')continue;var a=align[i];builder+='<'+(ishead?'th':'td')+(a&&a!=='left'?(' class="'+a+'"'):'')+'>'+column+'</'+(ishead?'th':'td')+'>'}return'<tr>'+builder+'</tr>'}function markdown_links(value){if(!value)return'';var end=value.lastIndexOf(']');var img=value.charAt(0)==='!';var text=value.substring(img?2:1,end);var link=value.substring(end+2,value.length-1);if((/^#\d+$/).test(link)){return(/^\d+$/).test(text)?'<sup data-id="{0}" class="markdown-footnote">{1}</sup>'.format(link.substring(1),text):'<span data-id="{0}" class="markdown-footnote">{1}</span>'.format(link.substring(1),text)}if(link.substring(0,4)==='www.')link='https://'+link;var nofollow=link.charAt(0)==='@'?' rel="nofollow"':linksexternal.test(link)?' target="_blank"':'';return'<a href="'+link+'"'+nofollow+'>'+text+'</a>'}function markdown_image(value){var end=value.lastIndexOf(']');var text=value.substring(2,end);var link=value.substring(end+2,value.length-1);var responsive=1,f=text.charAt(0);if(f==='+'){responsive=2;text=text.substring(1)}else if(f==='-'){responsive=3;text=text.substring(1)}return'<img src="'+link+'" alt="'+text+'"'+(responsive===1?' class="img-responsive"':responsive===3?' class="markdown-gallery"':'')+' border="0" loading="lazy" />'}function markdown_keywords(value){var keyword=value.substring(1,value.indexOf('}'));var type=value.substring(value.lastIndexOf('(')+1,value.lastIndexOf(')'));return'<span class="markdown-keyword" data-type="{0}">{1}</span>'.format(type,keyword)}function markdown_links2(value){value=value.substring(4,value.length-4);return'<a href="'+(value.isEmail()?'mailto:':linksexternal.test(value)?'':'http://')+value+'" target="_blank">'+value+'</a>'}function markdown_format(value,index,text){var p=text.charAt(index-1);var n=text.charAt(index+value.length);if((!p||regemptychar.test(p))&&(!n||regemptychar.test(n))){var beg='',end='',tag;if(value.indexOf('*')!==-1){tag=value.indexOf('**')===-1?'em':'strong';beg+='<'+tag+'>';end='</'+tag+'>'+end}if(value.indexOf('_')!==-1){tag=value.indexOf('__')===-1?'u':'b';beg+='<'+tag+'>';end='</'+tag+'>'+end}if(value.indexOf('~')!==-1){beg+='<strike>';end='</strike>'+end}var count=value.charAt(1)===value.charAt(0)?2:1;return beg+value.substring(count,value.length-count)+end}return value}function markdown_id(value){value=value.replace(regtags,'');return value.slug().replace(regdash,'-')}function markdown_icon(value){var beg=-1,end=-1;for(var i=0;i<value.length;i++){var code=value.charCodeAt(i);if(code===58){if(beg===-1)beg=i+1;else end=i}}var icon=value.substring(beg,end);if(icon.indexOf(' ')===-1)icon='fa fa-'+icon;return value.substring(0,beg-1)+'<i class="'+icon+'"></i>'+value.substring(end+1)}function markdown_urlify(str){return str.replace(/(^|\s)+(((https?:\/\/)|(www\.))[^\s]+)/g,function(url,b,c){var len=url.length,l=url.charAt(len-1);var f=url.charAt(0);if(l==='.'||l===',')url=url.substring(0,len-1);else l='';url=(c==='www.'?'http://'+url:url).trim();return(f.charCodeAt(0)<40?f:'')+'['+url+']('+url+')'+l})}FUNC.markdownredraw=function(el,opt){if(!el)el=opt.element||$('body');if(!opt)opt=EMPTYOBJECT;if(!opt.nosecret){el.find('.lang-secret').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);el.parent().replaceWith('<div class="markdown-secret" data-show="{0}" data-hide="{1}"><span class="markdown-showsecret"><i class="fa fa-lock"></i><i class="fa pull-right fa-angle-down"></i><b>{0}</b></span><div class="hidden">'.format(opt.showsecret||'Show secret data',opt.hidesecret||'Hide secret data')+el.html().trim().markdown(opt.secretoptions,true)+'</div></div>')})}if(!opt.novideo){el.find('.lang-video').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);var html=el.html();if(html.indexOf('youtube')!==-1)el.parent().replaceWith('<div class="markdown-video"><iframe src="https://www.youtube.com/embed/'+html.split('v=')[1]+'" frameborder="0" allowfullscreen></iframe></div>');else if(html.indexOf('vimeo')!==-1)el.parent().replaceWith('<div class="markdown-video"><iframe src="//player.vimeo.com/video/'+html.substring(html.lastIndexOf('/')+1)+'" frameborder="0" allowfullscreen></iframe></div>')})}if(!opt.nochart){el.find('.lang-barchart').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);var arr=el.html().split('\n').trim();var series=[],categories=[],y='';for(var i=0;i<arr.length;i++){var line=arr[i].split('|').trim();for(var j=1;j<line.length;j++){if(i===0)series.push({name:line[j],data:[]});else series[j-1].data.push(+line[j])}if(i)categories.push(line[0]);else y=line[0]}var options={chart:{height:300,type:'bar',},yaxis:{title:{text:y}},series:series,xaxis:{categories:categories,},fill:{opacity:1},},chart=new ApexCharts($(this).parent().empty()[0],options);chart.render()});el.find('.lang-linechart').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;if(!W.ApexCharts)return;var el=$(t);var arr=el.html().split('\n').trim();var series=[],categories=[],y='';for(var i=0;i<arr.length;i++){var line=arr[i].split('|').trim();for(var j=1;j<line.length;j++){if(i===0)series.push({name:line[j],data:[]});else series[j-1].data.push(+line[j])}if(i)categories.push(line[0]);else y=line[0]}var options={chart:{height:300,type:'line',},yaxis:{title:{text:y}},series:series,xaxis:{categories:categories,},fill:{opacity:1},},chart=new ApexCharts($(this).parent().empty()[0],options);chart.render()})}if(!opt.noiframe){el.find('.lang-iframe').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);el.parent().replaceWith('<div class="markdown-iframe">'+el.html().replace(/&lt;/g,'<').replace(/&gt;/g,'>')+'</div>')})}if(!opt.nocode){el.find('.markdown-code').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=true;W.hljs&&$(this).find('pre code').each(function(i,block){W.hljs.highlightBlock(block)})})}el.find('a').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);var href=el.attr('href');var c=href.substring(0,1);if(href==='#'){var beg='',end='',text=el.html();if(text.substring(0,1)==='<')beg='-';if(text.substring(text.length-1)==='>')end='-';el.attr('href','#'+(beg+markdown_id(el.text())+end))}else if(c!=='/'&&c!=='#')el.attr('target','_blank')});EMIT('markdown',el,opt);el.find('.markdown-code').rclass('hidden')};Thelpers.markdown=function(val,opt){return val?(val+'').markdown(opt):val};String.prototype.markdown=function(opt,nested){var str=this;if(!opt)opt={};var lines=str.split('\n');var builder=[],ul=[],table=false,iscode=false,isblock=false,ishead=false,isprevblock=false,prev,prevsize=0,previndex,tmp;if(opt.wrap==null)opt.wrap=true;if(opt.linetag==null)opt.linetag='p';var closeul=function(){while(ul.length){var text=ul.pop();builder.push('</'+text+'>')}};var formatlinks=function(val){return markdown_links(val,opt.images)};var linkscope=function(val,index,callback){var beg=-1,beg2=-1,can=false,skip=false,find=false,n;for(var i=index;i<val.length;i++){var c=val.charAt(i);if(c==='['){beg=i;can=false;find=true;continue}var codescope=val.substring(i,i+6);if(skip&&codescope==='</code'){skip=false;i+=7;continue}if(skip)continue;if(!find&&codescope==='<code>'){skip=true;continue}var il=val.substring(i,i+4);if(il==='&lt;'){beg2=i;continue}else if(beg2>-1&&il==='&gt;'){callback(val.substring(beg2,i+4),true);beg2=-1;continue}if(c===']'){can=false;find=false;if(beg===-1)continue;n=val.charAt(i+1);if(n===' ')n=val.charAt(i+2);can=n==='('}if(beg>-1&&can&&c===')'){n=val.charAt(beg-1);callback(val.substring(beg-(n==='!'?1:0),i+1));can=false;find=false;beg=-1}}};var formatline=function(line){var tmp=[];return line.replace(code,function(text){tmp.push(text);return'\0'}).replace(format,markdown_format).replace(/\0/g,function(){return markdown_code(tmp.shift())})};var imagescope=function(val){var beg=-1,can=false,n;for(var i=0;i<val.length;i++){var c=val.charAt(i);if(c==='['){beg=i;can=false;continue}if(c===']'){can=false;if(beg===-1)continue;n=val.charAt(i+1);if(n===' ')n=val.charAt(i+2);can=n==='('}if(beg>-1&&can&&c===')'){n=val.charAt(beg-1);var tmp=val.substring(beg-(n==='!'?1:0),i+1);if(tmp.charAt(0)==='!')val=val.replace(tmp,markdown_image(tmp));can=false;beg=-1}}return val};for(var i=0;i<lines.length;i++){lines[i]=lines[i].replace(encodetags,encode);var three=lines[i].substring(0,3);if(!iscode&&(three===':::'||(three==='==='))){if(isblock){if(opt.blocks!==false)builder[builder.length-1]+='</div></div>';isblock=false;isprevblock=true;continue}closeul();isblock=true;if(opt.blocks!==false){line=lines[i].substring(3).trim();if(opt.formatting!==false)line=formatline(line);builder.push('<div class="markdown-block"><span class="markdown-showblock"><i class="fa fa-plus"></i>{0}</span><div class="hidden">'.format(line))}prev='';continue}if(!isblock&&lines[i]&&isprevblock){builder.push('<br />');isprevblock=false}if(three==='```'){if(iscode){if(opt.code!==false)builder[builder.length-1]+='</code></pre></div>';iscode=false;continue}closeul();iscode=true;if(opt.code!==false)tmp='<div class="markdown-code hidden"><pre><code class="lang-'+lines[i].substring(3)+'">';prev='code';continue}if(iscode){if(opt.code!==false)builder.push(tmp+lines[i]);if(tmp)tmp='';continue}var line=lines[i];if(opt.br!==false)line=line.replace(/&lt;br(\s\/)?&gt;/g,'<br />');if(line.length>10&&opt.urlify!==false&&opt.links!==false)line=markdown_urlify(line);if(opt.custom)line=opt.custom(line);if(line.length>2&&line!=='***'&&line!=='---'){if(opt.formatting!==false)line=formatline(line);if(opt.images!==false)line=imagescope(line);if(opt.links!==false){linkscope(line,0,function(text,inline){if(inline)line=line.replace(text,markdown_links2);else if(opt.images!==false)line=line.replace(text,markdown_imagelinks);else line=line.replace(text,formatlinks)})}if(opt.keywords!==false)line=line.replace(keywords,markdown_keywords);if(opt.icons!==false)line=line.replace(regicons,markdown_icon)}if(!line){if(table){table=null;if(opt.tables!==false)builder.push('</tbody></table>')}}if(line===''&&lines[i-1]===''){closeul();if(opt.emptynewline!==false)builder.push('<br />');prev='br';continue}if(line[0]==='|'){closeul();if(!table){var next=lines[i+1];if(next[0]==='|'){table=[];var columns=next.substring(1,next.length-1).split('|');for(var j=0;j<columns.length;j++){var column=columns[j].trim();var align='left';if(column.charAt(column.length-1)===':')align=column[0]===':'?'center':'right';table.push(align)}if(opt.tables!==false)builder.push('<table class="table table-bordered"><thead>');prev='table';ishead=true;i++}else continue}if(opt.tables!==false){if(ishead)builder.push(markdown_table(line,table,true)+'</thead><tbody>');else builder.push(markdown_table(line,table))}ishead=false;continue}if(line.charAt(0)==='#'){closeul();if(line.substring(0,2)==='# '){tmp=line.substring(2).trim();if(opt.headlines!==false)builder.push('<h1 id="'+markdown_id(tmp)+'">'+tmp+'</h1>');prev='#';continue}if(line.substring(0,3)==='## '){tmp=line.substring(3).trim();if(opt.headlines!==false)builder.push('<h2 id="'+markdown_id(tmp)+'">'+tmp+'</h2>');prev='##';continue}if(line.substring(0,4)==='### '){tmp=line.substring(4).trim();if(opt.headlines!==false)builder.push('<h3 id="'+markdown_id(tmp)+'">'+tmp+'</h3>');prev='###';continue}if(line.substring(0,5)==='#### '){tmp=line.substring(5).trim();if(opt.headlines!==false)builder.push('<h4 id="'+markdown_id(tmp)+'">'+tmp+'</h4>');prev='####';continue}if(line.substring(0,6)==='##### '){tmp=line.substring(6).trim();if(opt.headlines!==false)builder.push('<h5 id="'+markdown_id(tmp)+'">'+tmp+'</h5>');prev='#####';continue}}tmp=line.substring(0,3);if(tmp==='---'||tmp==='***'){prev='hr';if(opt.hr!==false)builder.push('<hr class="markdown-line'+(tmp.charAt(0)==='-'?'1':'2')+'" />');continue}if((/^#\d+:(\s)+/).test(line)){if(opt.footnotes!==false){tmp=line.indexOf(':');builder.push('<div class="markdown-footnotebody" data-id="{0}"><span>{0}:</span> {1}</div>'.format(line.substring(1,tmp).trim(),line.substring(tmp+1).trim()))}continue}if(line.substring(0,5)==='&gt; '){if(opt.blockquotes!==false)builder.push('<blockquote>'+line.substring(5).trim()+'</blockquote>');prev='>';continue}if(line.substring(0,5)==='&lt; '){if(opt.sections!==false)builder.push('<section>'+line.substring(5).trim()+'</section>');prev='<';continue}var tmpline=line.trim();if(opt.ul!==false&&ordered.test(tmpline)){var size=line.match(orderedsize);if(size)size=size[0].length;else size=0;var append=false;if(prevsize!==size){if(size>prevsize){prevsize=size;append=true;var index=builder.length-1;builder[index]=builder[index].substring(0,builder[index].length-5);prev=''}else{prevsize=size;builder.push('</'+ul.pop()+'>')}}var type=tmpline.charAt(0)==='-'?'ul':'ol';if(prev!==type){var subtype;if(type==='ol')subtype=tmpline.charAt(0);previndex=builder.push('<'+type+(subtype?(' type="'+subtype+'"'):'')+'>')-1;ul.push(type+(append?'></li':''));prev=type;prevsize=size}var tmpstr=(type==='ol'?tmpline.substring(tmpline.indexOf('.')+1):tmpline.substring(2));if(type!=='ol'){var tt=tmpstr.substring(0,3);if(tt==='[ ]'||tt==='[x]'){if(previndex!=null)builder[previndex]=builder[previndex].replace('<ul','<ul class="markdown-tasks"');previndex=null}}builder.push('<li>'+tmpstr.trim().replace(/\[x\]/g,'<i class="fa fa-check-square green"></i>').replace(/\[\s\]/g,'<i class="far fa-square"></i>')+'</li>')}else{closeul();line&&builder.push((opt.linetag?('<'+opt.linetag+'>'):'')+line.trim()+(opt.linetag?('</'+opt.linetag+'>'):''));prev='p'}}closeul();table&&opt.tables!==false&&builder.push('</tbody></table>');iscode&&opt.code!==false&&builder.push('</code></pre>');if(!opt.noredraw&&typeof(window)==='object')setTimeout(FUNC.markdownredraw,1,null,opt);return(opt.wrap?('<div class="markdown'+(nested?'':' markdown-container')+'">'):'')+builder.join('\n').replace(/\t/g,'    ')+(opt.wrap?'</div>':'')}})()},['https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js','https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css']);
// End: j-Markdown